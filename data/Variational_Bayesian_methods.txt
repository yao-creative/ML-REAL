variational bayesian methods are a family of techniques for approximating intractable integrals arising in bayesian inference and machine learning.  they are typically used in complex statistical models consisting of observed variables (usually termed "data") as well as unknown parameters and latent variables, with various sorts of relationships among the three types of random variables, as might be described by a graphical model.  as typical in bayesian inference, the parameters and latent variables are grouped together as "unobserved variables". variational bayesian methods are primarily used for two purposes:

to provide an analytical approximation to the posterior probability of the unobserved variables, in order to do statistical inference over these variables.
to derive a lower bound for the marginal likelihood (sometimes called the evidence) of the observed data (i.e. the marginal probability of the data given the model, with marginalization performed over unobserved variables).  this is typically used for performing model selection, the general idea being that a higher marginal likelihood for a given model indicates a better fit of the data by that model and hence a greater probability that the model in question was the one that generated the data. (see also the bayes factor article.)in the former purpose (that of approximating a posterior probability), variational bayes is an alternative to monte carlo sampling methods — particularly, markov chain monte carlo methods such as gibbs sampling — for taking a fully bayesian approach to statistical inference over complex distributions that are difficult to evaluate directly or sample. in particular, whereas monte carlo techniques provide a numerical approximation to the exact posterior using a set of samples, variational bayes provides a locally-optimal, exact analytical solution to an approximation of the posterior.
variational bayes can be seen as an extension of the em (expectation-maximization) algorithm from maximum a posteriori estimation (map estimation) of the single most probable value of each parameter to fully bayesian estimation which computes (an approximation to) the entire posterior distribution of the parameters and latent variables.  as in em, it finds a set of optimal parameter values, and it has the same alternating structure as does em, based on a set of interlocked (mutually dependent) equations that cannot be solved analytically.
for many applications, variational bayes produces solutions of comparable accuracy to gibbs sampling at greater speed.  however, deriving the set of equations used to update the parameters iteratively often requires a large amount of work compared with deriving the comparable gibbs sampling equations.  this is the case even for many models that are conceptually quite simple, as is demonstrated below in the case of a basic non-hierarchical model with only two parameters and no latent variables.


== mathematical derivation ==


=== problem ===
in variational inference, the posterior distribution over a set of unobserved variables 
  
    
      
        
          z
        
        =
        {
        
          z
          
            1
          
        
        …
        
          z
          
            n
          
        
        }
      
    
    {\displaystyle \mathbf {z} =\{z_{1}\dots z_{n}\}}
   given some data 
  
    
      
        
          x
        
      
    
    {\displaystyle \mathbf {x} }
   is approximated by a so-called variational distribution, 
  
    
      
        q
        (
        
          z
        
        )
        :
      
    
    {\displaystyle q(\mathbf {z} ):}
  

  
    
      
        p
        (
        
          z
        
        ∣
        
          x
        
        )
        ≈
        q
        (
        
          z
        
        )
        .
      
    
    {\displaystyle p(\mathbf {z} \mid \mathbf {x} )\approx q(\mathbf {z} ).}
  the distribution 
  
    
      
        q
        (
        
          z
        
        )
      
    
    {\displaystyle q(\mathbf {z} )}
   is restricted to belong to a family of distributions of simpler form than 
  
    
      
        p
        (
        
          z
        
        ∣
        
          x
        
        )
      
    
    {\displaystyle p(\mathbf {z} \mid \mathbf {x} )}
   (e.g. a family of gaussian distributions), selected with the intention of making 
  
    
      
        q
        (
        
          z
        
        )
      
    
    {\displaystyle q(\mathbf {z} )}
   similar to the true posterior, 
  
    
      
        p
        (
        
          z
        
        ∣
        
          x
        
        )
      
    
    {\displaystyle p(\mathbf {z} \mid \mathbf {x} )}
  .
the similarity (or dissimilarity) is measured in terms of a dissimilarity function 
  
    
      
        d
        (
        q
        ;
        p
        )
      
    
    {\displaystyle d(q;p)}
   and hence inference is performed by selecting the distribution 
  
    
      
        q
        (
        
          z
        
        )
      
    
    {\displaystyle q(\mathbf {z} )}
   that minimizes 
  
    
      
        d
        (
        q
        ;
        p
        )
      
    
    {\displaystyle d(q;p)}
  .


=== kl divergence ===
the most common type of variational bayes uses the kullback–leibler divergence (kl-divergence) of q from p as the choice of dissimilarity function.  this choice makes this minimization tractable.  the kl-divergence is defined as

  
    
      
        
          d
          
            
              k
              l
            
          
        
        (
        q
        ∥
        p
        )
        ≜
        
          ∑
          
            
              z
            
          
        
        q
        (
        
          z
        
        )
        log
        ⁡
        
          
            
              q
              (
              
                z
              
              )
            
            
              p
              (
              
                z
              
              ∣
              
                x
              
              )
            
          
        
        .
      
    
    {\displaystyle d_{\mathrm {kl} }(q\parallel p)\triangleq \sum _{\mathbf {z} }q(\mathbf {z} )\log {\frac {q(\mathbf {z} )}{p(\mathbf {z} \mid \mathbf {x} )}}.}
  note that q and p are reversed from what one might expect.  this use of reversed kl-divergence is conceptually similar to the expectation-maximization algorithm. (using the kl-divergence in the other way produces the expectation propagation algorithm.)


=== intractability ===
variational techniques are typically used to form an approximation for:

  
    
      
        p
        (
        
          z
        
        ∣
        
          x
        
        )
        =
        
          
            
              p
              (
              
                x
              
              ∣
              
                z
              
              )
              p
              (
              
                z
              
              )
            
            
              p
              (
              
                x
              
              )
            
          
        
        =
        
          
            
              p
              (
              
                x
              
              ∣
              
                z
              
              )
              p
              (
              
                z
              
              )
            
            
              
                ∫
                
                  
                    z
                  
                
              
              p
              (
              
                x
              
              ,
              
                
                  z
                
                ′
              
              )
              
              d
              
                
                  z
                
                ′
              
            
          
        
      
    
    {\displaystyle p(\mathbf {z} \mid \mathbf {x} )={\frac {p(\mathbf {x} \mid \mathbf {z} )p(\mathbf {z} )}{p(\mathbf {x} )}}={\frac {p(\mathbf {x} \mid \mathbf {z} )p(\mathbf {z} )}{\int _{\mathbf {z} }p(\mathbf {x} ,\mathbf {z} ')\,d\mathbf {z} '}}}
  the marginalization over 
  
    
      
        
          z
        
      
    
    {\displaystyle \mathbf {z} }
   to calculate 
  
    
      
        p
        (
        
          x
        
        )
      
    
    {\displaystyle p(\mathbf {x} )}
   in the denominator is typically intractable, because, for example, the search space of 
  
    
      
        
          z
        
      
    
    {\displaystyle \mathbf {z} }
   is combinatorially large. therefore, we seek an approximation, using 
  
    
      
        q
        (
        
          z
        
        )
        ≈
        p
        (
        
          z
        
        ∣
        
          x
        
        )
      
    
    {\displaystyle q(\mathbf {z} )\approx p(\mathbf {z} \mid \mathbf {x} )}
  .


=== evidence lower bound ===

given that 
  
    
      
        p
        (
        
          z
        
        ∣
        
          x
        
        )
        =
        
          
            
              p
              (
              
                x
              
              ,
              
                z
              
              )
            
            
              p
              (
              
                x
              
              )
            
          
        
      
    
    {\displaystyle p(\mathbf {z} \mid \mathbf {x} )={\frac {p(\mathbf {x} ,\mathbf {z} )}{p(\mathbf {x} )}}}
  , the kl-divergence above can also be written as

  
    
      
        
          d
          
            
              k
              l
            
          
        
        (
        q
        ∥
        p
        )
        =
        
          ∑
          
            
              z
            
          
        
        q
        (
        
          z
        
        )
        
          [
          
            log
            ⁡
            
              
                
                  q
                  (
                  
                    z
                  
                  )
                
                
                  p
                  (
                  
                    z
                  
                  ,
                  
                    x
                  
                  )
                
              
            
            +
            log
            ⁡
            p
            (
            
              x
            
            )
          
          ]
        
        =
        
          ∑
          
            
              z
            
          
        
        q
        (
        
          z
        
        )
        
          [
          
            log
            ⁡
            q
            (
            
              z
            
            )
            −
            log
            ⁡
            p
            (
            
              z
            
            ,
            
              x
            
            )
          
          ]
        
        +
        
          ∑
          
            
              z
            
          
        
        q
        (
        
          z
        
        )
        
          [
          
            log
            ⁡
            p
            (
            
              x
            
            )
          
          ]
        
      
    
    {\displaystyle d_{\mathrm {kl} }(q\parallel p)=\sum _{\mathbf {z} }q(\mathbf {z} )\left[\log {\frac {q(\mathbf {z} )}{p(\mathbf {z} ,\mathbf {x} )}}+\log p(\mathbf {x} )\right]=\sum _{\mathbf {z} }q(\mathbf {z} )\left[\log q(\mathbf {z} )-\log p(\mathbf {z} ,\mathbf {x} )\right]+\sum _{\mathbf {z} }q(\mathbf {z} )\left[\log p(\mathbf {x} )\right]}
  because 
  
    
      
        p
        (
        
          x
        
        )
      
    
    {\displaystyle p(\mathbf {x} )}
   is a constant with respect to 
  
    
      
        
          z
        
      
    
    {\displaystyle \mathbf {z} }
   and 
  
    
      
        
          ∑
          
            
              z
            
          
        
        q
        (
        
          z
        
        )
        =
        1
      
    
    {\displaystyle \sum _{\mathbf {z} }q(\mathbf {z} )=1}
   because 
  
    
      
        q
        (
        
          z
        
        )
      
    
    {\displaystyle q(\mathbf {z} )}
   is a distribution, we have

  
    
      
        
          d
          
            
              k
              l
            
          
        
        (
        q
        ∥
        p
        )
        =
        
          ∑
          
            
              z
            
          
        
        q
        (
        
          z
        
        )
        
          [
          
            log
            ⁡
            q
            (
            
              z
            
            )
            −
            log
            ⁡
            p
            (
            
              z
            
            ,
            
              x
            
            )
          
          ]
        
        +
        log
        ⁡
        p
        (
        
          x
        
        )
      
    
    {\displaystyle d_{\mathrm {kl} }(q\parallel p)=\sum _{\mathbf {z} }q(\mathbf {z} )\left[\log q(\mathbf {z} )-\log p(\mathbf {z} ,\mathbf {x} )\right]+\log p(\mathbf {x} )}
  which, according to the definition of expected value (for a discrete random variable), can be written as follows

  
    
      
        
          d
          
            
              k
              l
            
          
        
        (
        q
        ∥
        p
        )
        =
        
          
            e
          
          
            
              q
            
          
        
        
          [
          
            log
            ⁡
            q
            (
            
              z
            
            )
            −
            log
            ⁡
            p
            (
            
              z
            
            ,
            
              x
            
            )
          
          ]
        
        +
        log
        ⁡
        p
        (
        
          x
        
        )
      
    
    {\displaystyle d_{\mathrm {kl} }(q\parallel p)=\mathbb {e} _{\mathbf {q} }\left[\log q(\mathbf {z} )-\log p(\mathbf {z} ,\mathbf {x} )\right]+\log p(\mathbf {x} )}
  which can be rearranged to become

  
    
      
        log
        ⁡
        p
        (
        
          x
        
        )
        =
        
          d
          
            
              k
              l
            
          
        
        (
        q
        ∥
        p
        )
        −
        
          
            e
          
          
            
              q
            
          
        
        
          [
          
            log
            ⁡
            q
            (
            
              z
            
            )
            −
            log
            ⁡
            p
            (
            
              z
            
            ,
            
              x
            
            )
          
          ]
        
        =
        
          d
          
            
              k
              l
            
          
        
        (
        q
        ∥
        p
        )
        +
        
          
            l
          
        
        (
        q
        )
      
    
    {\displaystyle \log p(\mathbf {x} )=d_{\mathrm {kl} }(q\parallel p)-\mathbb {e} _{\mathbf {q} }\left[\log q(\mathbf {z} )-\log p(\mathbf {z} ,\mathbf {x} )\right]=d_{\mathrm {kl} }(q\parallel p)+{\mathcal {l}}(q)}
  as the log-evidence 
  
    
      
        log
        ⁡
        p
        (
        
          x
        
        )
      
    
    {\displaystyle \log p(\mathbf {x} )}
   is fixed with respect to 
  
    
      
        q
      
    
    {\displaystyle q}
  , maximizing the final term 
  
    
      
        
          
            l
          
        
        (
        q
        )
      
    
    {\displaystyle {\mathcal {l}}(q)}
   minimizes the kl divergence of 
  
    
      
        q
      
    
    {\displaystyle q}
   from 
  
    
      
        p
      
    
    {\displaystyle p}
  .  by appropriate choice of 
  
    
      
        q
      
    
    {\displaystyle q}
  , 
  
    
      
        
          
            l
          
        
        (
        q
        )
      
    
    {\displaystyle {\mathcal {l}}(q)}
   becomes tractable to compute and to maximize. hence we have both an analytical approximation 
  
    
      
        q
      
    
    {\displaystyle q}
   for the posterior 
  
    
      
        p
        (
        
          z
        
        ∣
        
          x
        
        )
      
    
    {\displaystyle p(\mathbf {z} \mid \mathbf {x} )}
  , and a lower bound 
  
    
      
        
          
            l
          
        
        (
        q
        )
      
    
    {\displaystyle {\mathcal {l}}(q)}
   for the log-evidence 
  
    
      
        log
        ⁡
        p
        (
        
          x
        
        )
      
    
    {\displaystyle \log p(\mathbf {x} )}
   (since the kl-divergence is non-negative).
the lower bound 
  
    
      
        
          
            l
          
        
        (
        q
        )
      
    
    {\displaystyle {\mathcal {l}}(q)}
   is known as the (negative) variational free energy in analogy with thermodynamic free energy because it can also be expressed as a negative energy 
  
    
      
        
          e
          
            q
          
        
        ⁡
        [
        log
        ⁡
        p
        (
        
          z
        
        ,
        
          x
        
        )
        ]
      
    
    {\displaystyle \operatorname {e} _{q}[\log p(\mathbf {z} ,\mathbf {x} )]}
   plus the entropy of 
  
    
      
        q
      
    
    {\displaystyle q}
  . the term 
  
    
      
        
          
            l
          
        
        (
        q
        )
      
    
    {\displaystyle {\mathcal {l}}(q)}
   is also known as evidence lower bound, abbreviated as  elbo, to emphasize that it is a lower bound on the log-evidence of the data.


=== proofs ===
by the generalized pythagorean theorem of bregman divergence, of which kl-divergence is a special case, it can be shown that:

  
    
      
        
          d
          
            
              k
              l
            
          
        
        (
        q
        ∥
        p
        )
        ≥
        
          d
          
            
              k
              l
            
          
        
        (
        q
        ∥
        
          q
          
            ∗
          
        
        )
        +
        
          d
          
            
              k
              l
            
          
        
        (
        
          q
          
            ∗
          
        
        ∥
        p
        )
        ,
        ∀
        
          q
          
            ∗
          
        
        ∈
        
          
            c
          
        
      
    
    {\displaystyle d_{\mathrm {kl} }(q\parallel p)\geq d_{\mathrm {kl} }(q\parallel q^{*})+d_{\mathrm {kl} }(q^{*}\parallel p),\forall q^{*}\in {\mathcal {c}}}
  where  
  
    
      
        
          
            c
          
        
      
    
    {\displaystyle {\mathcal {c}}}
   is a convex set and the equality holds if:

  
    
      
        q
        =
        
          q
          
            ∗
          
        
        ≜
        arg
        ⁡
        
          min
          
            q
            ∈
            
              
                c
              
            
          
        
        
          d
          
            
              k
              l
            
          
        
        (
        q
        ∥
        p
        )
        .
      
    
    {\displaystyle q=q^{*}\triangleq \arg \min _{q\in {\mathcal {c}}}d_{\mathrm {kl} }(q\parallel p).}
  in this case, the global minimizer 
  
    
      
        
          q
          
            ∗
          
        
        (
        
          z
        
        )
        =
        
          q
          
            ∗
          
        
        (
        
          
            z
          
          
            1
          
        
        ∣
        
          
            z
          
          
            2
          
        
        )
        
          q
          
            ∗
          
        
        (
        
          
            z
          
          
            2
          
        
        )
        =
        
          q
          
            ∗
          
        
        (
        
          
            z
          
          
            2
          
        
        ∣
        
          
            z
          
          
            1
          
        
        )
        
          q
          
            ∗
          
        
        (
        
          
            z
          
          
            1
          
        
        )
        ,
      
    
    {\displaystyle q^{*}(\mathbf {z} )=q^{*}(\mathbf {z} _{1}\mid \mathbf {z} _{2})q^{*}(\mathbf {z} _{2})=q^{*}(\mathbf {z} _{2}\mid \mathbf {z} _{1})q^{*}(\mathbf {z} _{1}),}
   with 
  
    
      
        
          z
        
        =
        {
        
          
            z
            
              1
            
          
        
        ,
        
          
            z
            
              2
            
          
        
        }
        ,
      
    
    {\displaystyle \mathbf {z} =\{\mathbf {z_{1}} ,\mathbf {z_{2}} \},}
   can be found as follows:

  
    
      
        
          q
          
            ∗
          
        
        (
        
          
            z
          
          
            2
          
        
        )
        =
        
          
            
              p
              (
              
                x
              
              )
            
            
              ζ
              (
              
                x
              
              )
            
          
        
        
          
            
              p
              (
              
                
                  z
                
                
                  2
                
              
              ∣
              
                x
              
              )
            
            
              exp
              ⁡
              (
              
                d
                
                  
                    k
                    l
                  
                
              
              (
              
                q
                
                  ∗
                
              
              (
              
                
                  z
                
                
                  1
                
              
              ∣
              
                
                  z
                
                
                  2
                
              
              )
              ∥
              p
              (
              
                
                  z
                
                
                  1
                
              
              ∣
              
                
                  z
                
                
                  2
                
              
              ,
              
                x
              
              )
              )
              )
            
          
        
        =
        
          
            1
            
              ζ
              (
              
                x
              
              )
            
          
        
        exp
        ⁡
        
          
            e
          
          
            
              q
              
                ∗
              
            
            (
            
              
                z
              
              
                1
              
            
            ∣
            
              
                z
              
              
                2
              
            
            )
          
        
        
          (
          
            log
            ⁡
            
              
                
                  p
                  (
                  
                    z
                  
                  ,
                  
                    x
                  
                  )
                
                
                  
                    q
                    
                      ∗
                    
                  
                  (
                  
                    
                      z
                    
                    
                      1
                    
                  
                  ∣
                  
                    
                      z
                    
                    
                      2
                    
                  
                  )
                
              
            
          
          )
        
        ,
      
    
    {\displaystyle q^{*}(\mathbf {z} _{2})={\frac {p(\mathbf {x} )}{\zeta (\mathbf {x} )}}{\frac {p(\mathbf {z} _{2}\mid \mathbf {x} )}{\exp(d_{\mathrm {kl} }(q^{*}(\mathbf {z} _{1}\mid \mathbf {z} _{2})\parallel p(\mathbf {z} _{1}\mid \mathbf {z} _{2},\mathbf {x} )))}}={\frac {1}{\zeta (\mathbf {x} )}}\exp \mathbb {e} _{q^{*}(\mathbf {z} _{1}\mid \mathbf {z} _{2})}\left(\log {\frac {p(\mathbf {z} ,\mathbf {x} )}{q^{*}(\mathbf {z} _{1}\mid \mathbf {z} _{2})}}\right),}
  in which the normalizing constant is:

  
    
      
        ζ
        (
        
          x
        
        )
        =
        p
        (
        
          x
        
        )
        
          ∫
          
            
              
                z
              
              
                2
              
            
          
        
        
          
            
              p
              (
              
                
                  z
                
                
                  2
                
              
              ∣
              
                x
              
              )
            
            
              exp
              ⁡
              (
              
                d
                
                  
                    k
                    l
                  
                
              
              (
              
                q
                
                  ∗
                
              
              (
              
                
                  z
                
                
                  1
                
              
              ∣
              
                
                  z
                
                
                  2
                
              
              )
              ∥
              p
              (
              
                
                  z
                
                
                  1
                
              
              ∣
              
                
                  z
                
                
                  2
                
              
              ,
              
                x
              
              )
              )
              )
            
          
        
        =
        
          ∫
          
            
              
                z
              
              
                2
              
            
          
        
        exp
        ⁡
        
          
            e
          
          
            
              q
              
                ∗
              
            
            (
            
              
                z
              
              
                1
              
            
            ∣
            
              
                z
              
              
                2
              
            
            )
          
        
        
          (
          
            log
            ⁡
            
              
                
                  p
                  (
                  
                    z
                  
                  ,
                  
                    x
                  
                  )
                
                
                  
                    q
                    
                      ∗
                    
                  
                  (
                  
                    
                      z
                    
                    
                      1
                    
                  
                  ∣
                  
                    
                      z
                    
                    
                      2
                    
                  
                  )
                
              
            
          
          )
        
        .
      
    
    {\displaystyle \zeta (\mathbf {x} )=p(\mathbf {x} )\int _{\mathbf {z} _{2}}{\frac {p(\mathbf {z} _{2}\mid \mathbf {x} )}{\exp(d_{\mathrm {kl} }(q^{*}(\mathbf {z} _{1}\mid \mathbf {z} _{2})\parallel p(\mathbf {z} _{1}\mid \mathbf {z} _{2},\mathbf {x} )))}}=\int _{\mathbf {z} _{2}}\exp \mathbb {e} _{q^{*}(\mathbf {z} _{1}\mid \mathbf {z} _{2})}\left(\log {\frac {p(\mathbf {z} ,\mathbf {x} )}{q^{*}(\mathbf {z} _{1}\mid \mathbf {z} _{2})}}\right).}
  the term 
  
    
      
        ζ
        (
        
          x
        
        )
      
    
    {\displaystyle \zeta (\mathbf {x} )}
   is often called the evidence lower bound (elbo) in practice, since 
  
    
      
        p
        (
        
          x
        
        )
        ≥
        ζ
        (
        
          x
        
        )
        =
        exp
        ⁡
        (
        
          
            l
          
        
        (
        
          q
          
            ∗
          
        
        )
        )
      
    
    {\displaystyle p(\mathbf {x} )\geq \zeta (\mathbf {x} )=\exp({\mathcal {l}}(q^{*}))}
  , as shown above.
by interchanging the roles of 
  
    
      
        
          
            z
          
          
            1
          
        
      
    
    {\displaystyle \mathbf {z} _{1}}
   and 
  
    
      
        
          
            z
          
          
            2
          
        
        ,
      
    
    {\displaystyle \mathbf {z} _{2},}
   we can iteratively compute the approximated 
  
    
      
        
          q
          
            ∗
          
        
        (
        
          
            z
          
          
            1
          
        
        )
      
    
    {\displaystyle q^{*}(\mathbf {z} _{1})}
   and 
  
    
      
        
          q
          
            ∗
          
        
        (
        
          
            z
          
          
            2
          
        
        )
      
    
    {\displaystyle q^{*}(\mathbf {z} _{2})}
   of the true model's marginals 
  
    
      
        p
        (
        
          
            z
          
          
            1
          
        
        ∣
        
          x
        
        )
      
    
    {\displaystyle p(\mathbf {z} _{1}\mid \mathbf {x} )}
   and 
  
    
      
        p
        (
        
          
            z
          
          
            2
          
        
        ∣
        
          x
        
        )
        ,
      
    
    {\displaystyle p(\mathbf {z} _{2}\mid \mathbf {x} ),}
   respectively. although this iterative scheme is guaranteed to converge monotonically, the converged 
  
    
      
        
          q
          
            ∗
          
        
      
    
    {\displaystyle q^{*}}
   is only a local minimizer of 
  
    
      
        
          d
          
            
              k
              l
            
          
        
        (
        q
        ∥
        p
        )
      
    
    {\displaystyle d_{\mathrm {kl} }(q\parallel p)}
  .
if the constrained space 
  
    
      
        
          
            c
          
        
      
    
    {\displaystyle {\mathcal {c}}}
   is confined within independent space, i.e. 
  
    
      
        
          q
          
            ∗
          
        
        (
        
          
            z
          
          
            1
          
        
        ∣
        
          
            z
          
          
            2
          
        
        )
        =
        
          q
          
            ∗
          
        
        (
        
          
            z
            
              1
            
          
        
        )
        ,
      
    
    {\displaystyle q^{*}(\mathbf {z} _{1}\mid \mathbf {z} _{2})=q^{*}(\mathbf {z_{1}} ),}
  the above iterative scheme will become the so-called mean field approximation 
  
    
      
        
          q
          
            ∗
          
        
        (
        
          z
        
        )
        =
        
          q
          
            ∗
          
        
        (
        
          
            z
          
          
            1
          
        
        )
        
          q
          
            ∗
          
        
        (
        
          
            z
          
          
            2
          
        
        )
        ,
      
    
    {\displaystyle q^{*}(\mathbf {z} )=q^{*}(\mathbf {z} _{1})q^{*}(\mathbf {z} _{2}),}
  as shown below.


== mean field approximation ==
the variational distribution 
  
    
      
        q
        (
        
          z
        
        )
      
    
    {\displaystyle q(\mathbf {z} )}
   is usually assumed to factorize over some partition of the latent variables, i.e. for some partition of the latent variables 
  
    
      
        
          z
        
      
    
    {\displaystyle \mathbf {z} }
   into 
  
    
      
        
          
            z
          
          
            1
          
        
        …
        
          
            z
          
          
            m
          
        
      
    
    {\displaystyle \mathbf {z} _{1}\dots \mathbf {z} _{m}}
  ,

  
    
      
        q
        (
        
          z
        
        )
        =
        
          ∏
          
            i
            =
            1
          
          
            m
          
        
        
          q
          
            i
          
        
        (
        
          
            z
          
          
            i
          
        
        ∣
        
          x
        
        )
      
    
    {\displaystyle q(\mathbf {z} )=\prod _{i=1}^{m}q_{i}(\mathbf {z} _{i}\mid \mathbf {x} )}
  it can be shown using the calculus of variations (hence the name "variational bayes") that the "best" distribution 
  
    
      
        
          q
          
            j
          
          
            ∗
          
        
      
    
    {\displaystyle q_{j}^{*}}
   for each of the factors 
  
    
      
        
          q
          
            j
          
        
      
    
    {\displaystyle q_{j}}
   (in terms of the distribution minimizing the kl divergence, as described above) can be expressed as:

  
    
      
        
          q
          
            j
          
          
            ∗
          
        
        (
        
          
            z
          
          
            j
          
        
        ∣
        
          x
        
        )
        =
        
          
            
              e
              
                
                  e
                  
                    i
                    ≠
                    j
                  
                
                ⁡
                [
                ln
                ⁡
                p
                (
                
                  z
                
                ,
                
                  x
                
                )
                ]
              
            
            
              ∫
              
                e
                
                  
                    e
                    
                      i
                      ≠
                      j
                    
                  
                  ⁡
                  [
                  ln
                  ⁡
                  p
                  (
                  
                    z
                  
                  ,
                  
                    x
                  
                  )
                  ]
                
              
              
              d
              
                
                  z
                
                
                  j
                
              
            
          
        
      
    
    {\displaystyle q_{j}^{*}(\mathbf {z} _{j}\mid \mathbf {x} )={\frac {e^{\operatorname {e} _{i\neq j}[\ln p(\mathbf {z} ,\mathbf {x} )]}}{\int e^{\operatorname {e} _{i\neq j}[\ln p(\mathbf {z} ,\mathbf {x} )]}\,d\mathbf {z} _{j}}}}
  where 
  
    
      
        
          e
          
            i
            ≠
            j
          
        
        ⁡
        [
        ln
        ⁡
        p
        (
        
          z
        
        ,
        
          x
        
        )
        ]
      
    
    {\displaystyle \operatorname {e} _{i\neq j}[\ln p(\mathbf {z} ,\mathbf {x} )]}
   is the expectation of the logarithm of the joint probability of the data and latent variables, taken over all variables not in the partition: refer to for a derivation of the distribution 
  
    
      
        
          q
          
            j
          
          
            ∗
          
        
        (
        
          
            z
          
          
            j
          
        
        ∣
        
          x
        
        )
      
    
    {\displaystyle q_{j}^{*}(\mathbf {z} _{j}\mid \mathbf {x} )}
  .
in practice, we usually work in terms of logarithms, i.e.:

  
    
      
        ln
        ⁡
        
          q
          
            j
          
          
            ∗
          
        
        (
        
          
            z
          
          
            j
          
        
        ∣
        
          x
        
        )
        =
        
          e
          
            i
            ≠
            j
          
        
        ⁡
        [
        ln
        ⁡
        p
        (
        
          z
        
        ,
        
          x
        
        )
        ]
        +
        
          constant
        
      
    
    {\displaystyle \ln q_{j}^{*}(\mathbf {z} _{j}\mid \mathbf {x} )=\operatorname {e} _{i\neq j}[\ln p(\mathbf {z} ,\mathbf {x} )]+{\text{constant}}}
  the constant in the above expression is related to the normalizing constant (the denominator in the expression above for 
  
    
      
        
          q
          
            j
          
          
            ∗
          
        
      
    
    {\displaystyle q_{j}^{*}}
  ) and is usually reinstated by inspection, as the rest of the expression can usually be recognized as being a known type of distribution (e.g. gaussian, gamma, etc.).
using the properties of expectations, the expression 
  
    
      
        
          e
          
            i
            ≠
            j
          
        
        ⁡
        [
        ln
        ⁡
        p
        (
        
          z
        
        ,
        
          x
        
        )
        ]
      
    
    {\displaystyle \operatorname {e} _{i\neq j}[\ln p(\mathbf {z} ,\mathbf {x} )]}
   can usually be simplified into a function of the fixed hyperparameters of the prior distributions over the latent variables and of expectations (and sometimes higher moments such as the variance) of latent variables not in the current partition (i.e. latent variables not included in 
  
    
      
        
          
            z
          
          
            j
          
        
      
    
    {\displaystyle \mathbf {z} _{j}}
  ). this creates circular dependencies between the parameters of the distributions over variables in one partition and the expectations of variables in the other partitions.  this naturally suggests an iterative algorithm, much like em (the expectation-maximization algorithm), in which the expectations (and possibly higher moments) of the latent variables are initialized in some fashion (perhaps randomly), and then the parameters of each distribution are computed in turn using the current values of the expectations, after which the expectation of the newly computed distribution is set appropriately according to the computed parameters. an algorithm of this sort is guaranteed to converge.in other words, for each of the partitions of variables, by simplifying the expression for the distribution over the partition's variables and examining the distribution's functional dependency on the variables in question, the family of the distribution can usually be determined (which in turn determines the value of the constant).  the formula for the distribution's parameters will be expressed in terms of the prior distributions' hyperparameters (which are known constants), but also in terms of expectations of functions of variables in other partitions.  usually these expectations can be simplified into functions of expectations of the variables themselves (i.e. the means); sometimes expectations of squared variables (which can be related to the variance of the variables), or expectations of higher powers (i.e. higher moments) also appear. in most cases, the other variables' distributions will be from known families, and the formulas for the relevant expectations can be looked up. however, those formulas depend on those distributions' parameters, which depend in turn on the expectations about other variables. the result is that the formulas for the parameters of each variable's distributions can be expressed as a series of equations with mutual, nonlinear dependencies among the variables. usually, it is not possible to solve this system of equations directly. however, as described above, the dependencies suggest a simple iterative algorithm, which in most cases is guaranteed to converge. an example will make this process clearer.


== a duality formula for variational inference ==

the following theorem is referred to as a duality formula for variational inference. it explains some important properties of the variational distributions used in variational bayes methods.
theorem consider two probability spaces 
  
    
      
        (
        θ
        ,
        
          
            f
          
        
        ,
        p
        )
      
    
    {\displaystyle (\theta ,{\mathcal {f}},p)}
   and 
  
    
      
        (
        θ
        ,
        
          
            f
          
        
        ,
        q
        )
      
    
    {\displaystyle (\theta ,{\mathcal {f}},q)}
   with 
  
    
      
        q
        ≪
        p
      
    
    {\displaystyle q\ll p}
  . assume that there is a common dominating probability measure 
  
    
      
        λ
      
    
    {\displaystyle \lambda }
   such that 
  
    
      
        p
        ≪
        λ
      
    
    {\displaystyle p\ll \lambda }
   and 
  
    
      
        q
        ≪
        λ
      
    
    {\displaystyle q\ll \lambda }
  . let 
  
    
      
        h
      
    
    {\displaystyle h}
   denote any real-valued random variable on 
  
    
      
        (
        θ
        ,
        
          
            f
          
        
        ,
        p
        )
      
    
    {\displaystyle (\theta ,{\mathcal {f}},p)}
   that satisfies 
  
    
      
        h
        ∈
        
          l
          
            1
          
        
        (
        p
        )
      
    
    {\displaystyle h\in l_{1}(p)}
  . then the following equality holds

  
    
      
        log
        ⁡
        
          e
          
            p
          
        
        [
        exp
        ⁡
        h
        ]
        =
        
          
            sup
          
          
            q
            ≪
            p
          
        
        {
        
          e
          
            q
          
        
        [
        h
        ]
        −
        
          d
          
            kl
          
        
        (
        q
        ∥
        p
        )
        }
        .
      
    
    {\displaystyle \log e_{p}[\exp h]={\text{sup}}_{q\ll p}\{e_{q}[h]-d_{\text{kl}}(q\parallel p)\}.}
  further, the supremum on the right-hand side is attained if and only if it holds

  
    
      
        
          
            
              q
              (
              θ
              )
            
            
              p
              (
              θ
              )
            
          
        
        =
        
          
            
              exp
              ⁡
              h
              (
              θ
              )
            
            
              
                e
                
                  p
                
              
              [
              exp
              ⁡
              h
              ]
            
          
        
        ,
      
    
    {\displaystyle {\frac {q(\theta )}{p(\theta )}}={\frac {\exp h(\theta )}{e_{p}[\exp h]}},}
  almost surely with respect to probability measure 
  
    
      
        q
      
    
    {\displaystyle q}
  , where 
  
    
      
        p
        (
        θ
        )
        =
        d
        p
        
          /
        
        d
        λ
      
    
    {\displaystyle p(\theta )=dp/d\lambda }
   and 
  
    
      
        q
        (
        θ
        )
        =
        d
        q
        
          /
        
        d
        λ
      
    
    {\displaystyle q(\theta )=dq/d\lambda }
   denote the radon-nikodym derivatives of the probability measures 
  
    
      
        p
      
    
    {\displaystyle p}
   and 
  
    
      
        q
      
    
    {\displaystyle q}
   with respect to 
  
    
      
        λ
      
    
    {\displaystyle \lambda }
  , respectively.


== a basic example ==
consider a simple non-hierarchical bayesian model consisting of a set of i.i.d. observations from a gaussian distribution, with unknown mean and variance. in the following, we work through this model in great detail to illustrate the workings of the variational bayes method.
for mathematical convenience, in the following example we work in terms of the precision — i.e. the reciprocal of the variance (or in a multivariate gaussian, the inverse of the covariance matrix) — rather than the variance itself.  (from a theoretical standpoint, precision and variance are equivalent since there is a one-to-one correspondence between the two.)


=== the mathematical model ===
we place conjugate prior distributions on the unknown mean 
  
    
      
        μ
      
    
    {\displaystyle \mu }
   and precision 
  
    
      
        τ
      
    
    {\displaystyle \tau }
  , i.e. the mean also follows a gaussian distribution while the precision follows a gamma distribution.  in other words:

  
    
      
        
          
            
              
                τ
              
              
                
                ∼
                gamma
                ⁡
                (
                
                  a
                  
                    0
                  
                
                ,
                
                  b
                  
                    0
                  
                
                )
              
            
            
              
                μ
                
                  |
                
                τ
              
              
                
                ∼
                
                  
                    n
                  
                
                (
                
                  μ
                  
                    0
                  
                
                ,
                (
                
                  λ
                  
                    0
                  
                
                τ
                
                  )
                  
                    −
                    1
                  
                
                )
              
            
            
              
                {
                
                  x
                  
                    1
                  
                
                ,
                …
                ,
                
                  x
                  
                    n
                  
                
                }
              
              
                
                ∼
                
                  
                    n
                  
                
                (
                μ
                ,
                
                  τ
                  
                    −
                    1
                  
                
                )
              
            
            
              
                n
              
              
                
                =
                
                  number of data points
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\tau &\sim \operatorname {gamma} (a_{0},b_{0})\\\mu |\tau &\sim {\mathcal {n}}(\mu _{0},(\lambda _{0}\tau )^{-1})\\\{x_{1},\dots ,x_{n}\}&\sim {\mathcal {n}}(\mu ,\tau ^{-1})\\n&={\text{number of data points}}\end{aligned}}}
  the hyperparameters 
  
    
      
        
          μ
          
            0
          
        
        ,
        
          λ
          
            0
          
        
        ,
        
          a
          
            0
          
        
      
    
    {\displaystyle \mu _{0},\lambda _{0},a_{0}}
   and 
  
    
      
        
          b
          
            0
          
        
      
    
    {\displaystyle b_{0}}
   in the prior distributions are fixed, given values.  they can be set to small positive numbers to give broad prior distributions indicating ignorance about the prior distributions of 
  
    
      
        μ
      
    
    {\displaystyle \mu }
   and 
  
    
      
        τ
      
    
    {\displaystyle \tau }
  .
we are given 
  
    
      
        n
      
    
    {\displaystyle n}
   data points 
  
    
      
        
          x
        
        =
        {
        
          x
          
            1
          
        
        ,
        …
        ,
        
          x
          
            n
          
        
        }
      
    
    {\displaystyle \mathbf {x} =\{x_{1},\ldots ,x_{n}\}}
   and our goal is to infer the posterior distribution 
  
    
      
        q
        (
        μ
        ,
        τ
        )
        =
        p
        (
        μ
        ,
        τ
        ∣
        
          x
          
            1
          
        
        ,
        …
        ,
        
          x
          
            n
          
        
        )
      
    
    {\displaystyle q(\mu ,\tau )=p(\mu ,\tau \mid x_{1},\ldots ,x_{n})}
   of the parameters 
  
    
      
        μ
      
    
    {\displaystyle \mu }
   and 
  
    
      
        τ
        .
      
    
    {\displaystyle \tau .}
  


=== the joint probability ===
the joint probability of all variables can be rewritten as

  
    
      
        p
        (
        
          x
        
        ,
        μ
        ,
        τ
        )
        =
        p
        (
        
          x
        
        ∣
        μ
        ,
        τ
        )
        p
        (
        μ
        ∣
        τ
        )
        p
        (
        τ
        )
      
    
    {\displaystyle p(\mathbf {x} ,\mu ,\tau )=p(\mathbf {x} \mid \mu ,\tau )p(\mu \mid \tau )p(\tau )}
  where the individual factors are

  
    
      
        
          
            
              
                p
                (
                
                  x
                
                ∣
                μ
                ,
                τ
                )
              
              
                
                =
                
                  ∏
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  
                    n
                  
                
                (
                
                  x
                  
                    n
                  
                
                ∣
                μ
                ,
                
                  τ
                  
                    −
                    1
                  
                
                )
              
            
            
              
                p
                (
                μ
                ∣
                τ
                )
              
              
                
                =
                
                  
                    n
                  
                
                
                  (
                  
                    μ
                    ∣
                    
                      μ
                      
                        0
                      
                    
                    ,
                    (
                    
                      λ
                      
                        0
                      
                    
                    τ
                    
                      )
                      
                        −
                        1
                      
                    
                  
                  )
                
              
            
            
              
                p
                (
                τ
                )
              
              
                
                =
                gamma
                ⁡
                (
                τ
                ∣
                
                  a
                  
                    0
                  
                
                ,
                
                  b
                  
                    0
                  
                
                )
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}p(\mathbf {x} \mid \mu ,\tau )&=\prod _{n=1}^{n}{\mathcal {n}}(x_{n}\mid \mu ,\tau ^{-1})\\p(\mu \mid \tau )&={\mathcal {n}}\left(\mu \mid \mu _{0},(\lambda _{0}\tau )^{-1}\right)\\p(\tau )&=\operatorname {gamma} (\tau \mid a_{0},b_{0})\end{aligned}}}
  where

  
    
      
        
          
            
              
                
                  
                    n
                  
                
                (
                x
                ∣
                μ
                ,
                
                  σ
                  
                    2
                  
                
                )
              
              
                
                =
                
                  
                    1
                    
                      2
                      π
                      
                        σ
                        
                          2
                        
                      
                    
                  
                
                
                  e
                  
                    
                      
                        −
                        (
                        x
                        −
                        μ
                        
                          )
                          
                            2
                          
                        
                      
                      
                        2
                        
                          σ
                          
                            2
                          
                        
                      
                    
                  
                
              
            
            
              
                gamma
                ⁡
                (
                τ
                ∣
                a
                ,
                b
                )
              
              
                
                =
                
                  
                    1
                    
                      γ
                      (
                      a
                      )
                    
                  
                
                
                  b
                  
                    a
                  
                
                
                  τ
                  
                    a
                    −
                    1
                  
                
                
                  e
                  
                    −
                    b
                    τ
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}{\mathcal {n}}(x\mid \mu ,\sigma ^{2})&={\frac {1}{\sqrt {2\pi \sigma ^{2}}}}e^{\frac {-(x-\mu )^{2}}{2\sigma ^{2}}}\\\operatorname {gamma} (\tau \mid a,b)&={\frac {1}{\gamma (a)}}b^{a}\tau ^{a-1}e^{-b\tau }\end{aligned}}}
  


=== factorized approximation ===
assume that 
  
    
      
        q
        (
        μ
        ,
        τ
        )
        =
        q
        (
        μ
        )
        q
        (
        τ
        )
      
    
    {\displaystyle q(\mu ,\tau )=q(\mu )q(\tau )}
  , i.e. that the posterior distribution factorizes into independent factors for 
  
    
      
        μ
      
    
    {\displaystyle \mu }
   and 
  
    
      
        τ
      
    
    {\displaystyle \tau }
  .  this type of assumption underlies the variational bayesian method.  the true posterior distribution does not in fact factor this way (in fact, in this simple case, it is known to be a gaussian-gamma distribution), and hence the result we obtain will be an approximation.


=== derivation of q(μ) ===
then

  
    
      
        
          
            
              
                ln
                ⁡
                
                  q
                  
                    μ
                  
                  
                    ∗
                  
                
                (
                μ
                )
              
              
                
                =
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    ln
                    ⁡
                    p
                    (
                    
                      x
                    
                    ∣
                    μ
                    ,
                    τ
                    )
                    +
                    ln
                    ⁡
                    p
                    (
                    μ
                    ∣
                    τ
                    )
                    +
                    ln
                    ⁡
                    p
                    (
                    τ
                    )
                  
                  ]
                
                +
                c
              
            
            
              
              
                
                =
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    ln
                    ⁡
                    p
                    (
                    
                      x
                    
                    ∣
                    μ
                    ,
                    τ
                    )
                  
                  ]
                
                +
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    ln
                    ⁡
                    p
                    (
                    μ
                    ∣
                    τ
                    )
                  
                  ]
                
                +
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    ln
                    ⁡
                    p
                    (
                    τ
                    )
                  
                  ]
                
                +
                c
              
            
            
              
              
                
                =
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    ln
                    ⁡
                    
                      ∏
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    
                      
                        n
                      
                    
                    
                      (
                      
                        
                          x
                          
                            n
                          
                        
                        ∣
                        μ
                        ,
                        
                          τ
                          
                            −
                            1
                          
                        
                      
                      )
                    
                  
                  ]
                
                +
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    ln
                    ⁡
                    
                      
                        n
                      
                    
                    
                      (
                      
                        μ
                        ∣
                        
                          μ
                          
                            0
                          
                        
                        ,
                        (
                        
                          λ
                          
                            0
                          
                        
                        τ
                        
                          )
                          
                            −
                            1
                          
                        
                      
                      )
                    
                  
                  ]
                
                +
                
                  c
                  
                    2
                  
                
              
            
            
              
              
                
                =
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    ln
                    ⁡
                    
                      ∏
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    
                      
                        
                          τ
                          
                            2
                            π
                          
                        
                      
                    
                    
                      e
                      
                        −
                        
                          
                            
                              (
                              
                                x
                                
                                  n
                                
                              
                              −
                              μ
                              
                                )
                                
                                  2
                                
                              
                              τ
                            
                            2
                          
                        
                      
                    
                  
                  ]
                
                +
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    ln
                    ⁡
                    
                      
                        
                          
                            
                              λ
                              
                                0
                              
                            
                            τ
                          
                          
                            2
                            π
                          
                        
                      
                    
                    
                      e
                      
                        −
                        
                          
                            
                              (
                              μ
                              −
                              
                                μ
                                
                                  0
                                
                              
                              
                                )
                                
                                  2
                                
                              
                              
                                λ
                                
                                  0
                                
                              
                              τ
                            
                            2
                          
                        
                      
                    
                  
                  ]
                
                +
                
                  c
                  
                    2
                  
                
              
            
            
              
              
                
                =
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    
                      (
                      
                        
                          
                            1
                            2
                          
                        
                        (
                        ln
                        ⁡
                        τ
                        −
                        ln
                        ⁡
                        2
                        π
                        )
                        −
                        
                          
                            
                              (
                              
                                x
                                
                                  n
                                
                              
                              −
                              μ
                              
                                )
                                
                                  2
                                
                              
                              τ
                            
                            2
                          
                        
                      
                      )
                    
                  
                  ]
                
                +
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    
                      
                        1
                        2
                      
                    
                    (
                    ln
                    ⁡
                    
                      λ
                      
                        0
                      
                    
                    +
                    ln
                    ⁡
                    τ
                    −
                    ln
                    ⁡
                    2
                    π
                    )
                    −
                    
                      
                        
                          (
                          μ
                          −
                          
                            μ
                            
                              0
                            
                          
                          
                            )
                            
                              2
                            
                          
                          
                            λ
                            
                              0
                            
                          
                          τ
                        
                        2
                      
                    
                  
                  ]
                
                +
                
                  c
                  
                    2
                  
                
              
            
            
              
              
                
                =
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    −
                    
                      
                        
                          (
                          
                            x
                            
                              n
                            
                          
                          −
                          μ
                          
                            )
                            
                              2
                            
                          
                          τ
                        
                        2
                      
                    
                  
                  ]
                
                +
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    −
                    
                      
                        
                          (
                          μ
                          −
                          
                            μ
                            
                              0
                            
                          
                          
                            )
                            
                              2
                            
                          
                          
                            λ
                            
                              0
                            
                          
                          τ
                        
                        2
                      
                    
                  
                  ]
                
                +
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    
                      
                        1
                        2
                      
                    
                    (
                    ln
                    ⁡
                    τ
                    −
                    ln
                    ⁡
                    2
                    π
                    )
                  
                  ]
                
                +
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    
                      
                        1
                        2
                      
                    
                    (
                    ln
                    ⁡
                    
                      λ
                      
                        0
                      
                    
                    +
                    ln
                    ⁡
                    τ
                    −
                    ln
                    ⁡
                    2
                    π
                    )
                  
                  ]
                
                +
                
                  c
                  
                    2
                  
                
              
            
            
              
              
                
                =
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    −
                    
                      
                        
                          (
                          
                            x
                            
                              n
                            
                          
                          −
                          μ
                          
                            )
                            
                              2
                            
                          
                          τ
                        
                        2
                      
                    
                  
                  ]
                
                +
                
                  e
                  
                    τ
                  
                
                ⁡
                
                  [
                  
                    −
                    
                      
                        
                          (
                          μ
                          −
                          
                            μ
                            
                              0
                            
                          
                          
                            )
                            
                              2
                            
                          
                          
                            λ
                            
                              0
                            
                          
                          τ
                        
                        2
                      
                    
                  
                  ]
                
                +
                
                  c
                  
                    3
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    (
                    
                      x
                      
                        n
                      
                    
                    −
                    μ
                    
                      )
                      
                        2
                      
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    (
                    μ
                    −
                    
                      μ
                      
                        0
                      
                    
                    
                      )
                      
                        2
                      
                    
                  
                  }
                
                +
                
                  c
                  
                    3
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\ln q_{\mu }^{*}(\mu )&=\operatorname {e} _{\tau }\left[\ln p(\mathbf {x} \mid \mu ,\tau )+\ln p(\mu \mid \tau )+\ln p(\tau )\right]+c\\&=\operatorname {e} _{\tau }\left[\ln p(\mathbf {x} \mid \mu ,\tau )\right]+\operatorname {e} _{\tau }\left[\ln p(\mu \mid \tau )\right]+\operatorname {e} _{\tau }\left[\ln p(\tau )\right]+c\\&=\operatorname {e} _{\tau }\left[\ln \prod _{n=1}^{n}{\mathcal {n}}\left(x_{n}\mid \mu ,\tau ^{-1}\right)\right]+\operatorname {e} _{\tau }\left[\ln {\mathcal {n}}\left(\mu \mid \mu _{0},(\lambda _{0}\tau )^{-1}\right)\right]+c_{2}\\&=\operatorname {e} _{\tau }\left[\ln \prod _{n=1}^{n}{\sqrt {\frac {\tau }{2\pi }}}e^{-{\frac {(x_{n}-\mu )^{2}\tau }{2}}}\right]+\operatorname {e} _{\tau }\left[\ln {\sqrt {\frac {\lambda _{0}\tau }{2\pi }}}e^{-{\frac {(\mu -\mu _{0})^{2}\lambda _{0}\tau }{2}}}\right]+c_{2}\\&=\operatorname {e} _{\tau }\left[\sum _{n=1}^{n}\left({\frac {1}{2}}(\ln \tau -\ln 2\pi )-{\frac {(x_{n}-\mu )^{2}\tau }{2}}\right)\right]+\operatorname {e} _{\tau }\left[{\frac {1}{2}}(\ln \lambda _{0}+\ln \tau -\ln 2\pi )-{\frac {(\mu -\mu _{0})^{2}\lambda _{0}\tau }{2}}\right]+c_{2}\\&=\operatorname {e} _{\tau }\left[\sum _{n=1}^{n}-{\frac {(x_{n}-\mu )^{2}\tau }{2}}\right]+\operatorname {e} _{\tau }\left[-{\frac {(\mu -\mu _{0})^{2}\lambda _{0}\tau }{2}}\right]+\operatorname {e} _{\tau }\left[\sum _{n=1}^{n}{\frac {1}{2}}(\ln \tau -\ln 2\pi )\right]+\operatorname {e} _{\tau }\left[{\frac {1}{2}}(\ln \lambda _{0}+\ln \tau -\ln 2\pi )\right]+c_{2}\\&=\operatorname {e} _{\tau }\left[\sum _{n=1}^{n}-{\frac {(x_{n}-\mu )^{2}\tau }{2}}\right]+\operatorname {e} _{\tau }\left[-{\frac {(\mu -\mu _{0})^{2}\lambda _{0}\tau }{2}}\right]+c_{3}\\&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{\sum _{n=1}^{n}(x_{n}-\mu )^{2}+\lambda _{0}(\mu -\mu _{0})^{2}\right\}+c_{3}\end{aligned}}}
  in the above derivation, 
  
    
      
        c
      
    
    {\displaystyle c}
  , 
  
    
      
        
          c
          
            2
          
        
      
    
    {\displaystyle c_{2}}
   and 
  
    
      
        
          c
          
            3
          
        
      
    
    {\displaystyle c_{3}}
   refer to values that are constant with respect to 
  
    
      
        μ
      
    
    {\displaystyle \mu }
  .  note that the term 
  
    
      
        
          e
          
            τ
          
        
        ⁡
        [
        ln
        ⁡
        p
        (
        τ
        )
        ]
      
    
    {\displaystyle \operatorname {e} _{\tau }[\ln p(\tau )]}
   is not a function of 
  
    
      
        μ
      
    
    {\displaystyle \mu }
   and will have the same value regardless of the value of 
  
    
      
        μ
      
    
    {\displaystyle \mu }
  .  hence in line 3 we can absorb it into the constant term at the end.  we do the same thing in line 7.
the last line is simply a quadratic polynomial in 
  
    
      
        μ
      
    
    {\displaystyle \mu }
  .  since this is the logarithm of 
  
    
      
        
          q
          
            μ
          
          
            ∗
          
        
        (
        μ
        )
      
    
    {\displaystyle q_{\mu }^{*}(\mu )}
  , we can see that 
  
    
      
        
          q
          
            μ
          
          
            ∗
          
        
        (
        μ
        )
      
    
    {\displaystyle q_{\mu }^{*}(\mu )}
   itself is a gaussian distribution.
with a certain amount of tedious math (expanding the squares inside of the braces, separating out and grouping the terms involving 
  
    
      
        μ
      
    
    {\displaystyle \mu }
   and 
  
    
      
        
          μ
          
            2
          
        
      
    
    {\displaystyle \mu ^{2}}
   and completing the square over 
  
    
      
        μ
      
    
    {\displaystyle \mu }
  ), we can derive the parameters of the gaussian distribution:

  
    
      
        
          
            
              
                ln
                ⁡
                
                  q
                  
                    μ
                  
                  
                    ∗
                  
                
                (
                μ
                )
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    (
                    
                      x
                      
                        n
                      
                    
                    −
                    μ
                    
                      )
                      
                        2
                      
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    (
                    μ
                    −
                    
                      μ
                      
                        0
                      
                    
                    
                      )
                      
                        2
                      
                    
                  
                  }
                
                +
                
                  c
                  
                    3
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    (
                    
                      x
                      
                        n
                      
                      
                        2
                      
                    
                    −
                    2
                    
                      x
                      
                        n
                      
                    
                    μ
                    +
                    
                      μ
                      
                        2
                      
                    
                    )
                    +
                    
                      λ
                      
                        0
                      
                    
                    (
                    
                      μ
                      
                        2
                      
                    
                    −
                    2
                    
                      μ
                      
                        0
                      
                    
                    μ
                    +
                    
                      μ
                      
                        0
                      
                      
                        2
                      
                    
                    )
                  
                  }
                
                +
                
                  c
                  
                    3
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    
                      (
                      
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                          
                            2
                          
                        
                      
                      )
                    
                    −
                    2
                    
                      (
                      
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                        
                      
                      )
                    
                    μ
                    +
                    
                      (
                      
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          μ
                          
                            2
                          
                        
                      
                      )
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    
                      μ
                      
                        2
                      
                    
                    −
                    2
                    
                      λ
                      
                        0
                      
                    
                    
                      μ
                      
                        0
                      
                    
                    μ
                    +
                    
                      λ
                      
                        0
                      
                    
                    
                      μ
                      
                        0
                      
                      
                        2
                      
                    
                  
                  }
                
                +
                
                  c
                  
                    3
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      μ
                      
                        2
                      
                    
                    −
                    2
                    
                      (
                      
                        
                          λ
                          
                            0
                          
                        
                        
                          μ
                          
                            0
                          
                        
                        +
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                        
                      
                      )
                    
                    μ
                    +
                    
                      (
                      
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                          
                            2
                          
                        
                      
                      )
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    
                      μ
                      
                        0
                      
                      
                        2
                      
                    
                  
                  }
                
                +
                
                  c
                  
                    3
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      μ
                      
                        2
                      
                    
                    −
                    2
                    
                      (
                      
                        
                          λ
                          
                            0
                          
                        
                        
                          μ
                          
                            0
                          
                        
                        +
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                        
                      
                      )
                    
                    μ
                  
                  }
                
                +
                
                  c
                  
                    4
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      μ
                      
                        2
                      
                    
                    −
                    2
                    
                      (
                      
                        
                          
                            
                              λ
                              
                                0
                              
                            
                            
                              μ
                              
                                0
                              
                            
                            +
                            
                              ∑
                              
                                n
                                =
                                1
                              
                              
                                n
                              
                            
                            
                              x
                              
                                n
                              
                            
                          
                          
                            
                              λ
                              
                                0
                              
                            
                            +
                            n
                          
                        
                      
                      )
                    
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    μ
                  
                  }
                
                +
                
                  c
                  
                    4
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      (
                      
                        
                          μ
                          
                            2
                          
                        
                        −
                        2
                        
                          (
                          
                            
                              
                                
                                  λ
                                  
                                    0
                                  
                                
                                
                                  μ
                                  
                                    0
                                  
                                
                                +
                                
                                  ∑
                                  
                                    n
                                    =
                                    1
                                  
                                  
                                    n
                                  
                                
                                
                                  x
                                  
                                    n
                                  
                                
                              
                              
                                
                                  λ
                                  
                                    0
                                  
                                
                                +
                                n
                              
                            
                          
                          )
                        
                        μ
                      
                      )
                    
                  
                  }
                
                +
                
                  c
                  
                    4
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      (
                      
                        
                          μ
                          
                            2
                          
                        
                        −
                        2
                        
                          (
                          
                            
                              
                                
                                  λ
                                  
                                    0
                                  
                                
                                
                                  μ
                                  
                                    0
                                  
                                
                                +
                                
                                  ∑
                                  
                                    n
                                    =
                                    1
                                  
                                  
                                    n
                                  
                                
                                
                                  x
                                  
                                    n
                                  
                                
                              
                              
                                
                                  λ
                                  
                                    0
                                  
                                
                                +
                                n
                              
                            
                          
                          )
                        
                        μ
                        +
                        
                          
                            (
                            
                              
                                
                                  
                                    λ
                                    
                                      0
                                    
                                  
                                  
                                    μ
                                    
                                      0
                                    
                                  
                                  +
                                  
                                    ∑
                                    
                                      n
                                      =
                                      1
                                    
                                    
                                      n
                                    
                                  
                                  
                                    x
                                    
                                      n
                                    
                                  
                                
                                
                                  
                                    λ
                                    
                                      0
                                    
                                  
                                  +
                                  n
                                
                              
                            
                            )
                          
                          
                            2
                          
                        
                        −
                        
                          
                            (
                            
                              
                                
                                  
                                    λ
                                    
                                      0
                                    
                                  
                                  
                                    μ
                                    
                                      0
                                    
                                  
                                  +
                                  
                                    ∑
                                    
                                      n
                                      =
                                      1
                                    
                                    
                                      n
                                    
                                  
                                  
                                    x
                                    
                                      n
                                    
                                  
                                
                                
                                  
                                    λ
                                    
                                      0
                                    
                                  
                                  +
                                  n
                                
                              
                            
                            )
                          
                          
                            2
                          
                        
                      
                      )
                    
                  
                  }
                
                +
                
                  c
                  
                    4
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      (
                      
                        
                          μ
                          
                            2
                          
                        
                        −
                        2
                        
                          (
                          
                            
                              
                                
                                  λ
                                  
                                    0
                                  
                                
                                
                                  μ
                                  
                                    0
                                  
                                
                                +
                                
                                  ∑
                                  
                                    n
                                    =
                                    1
                                  
                                  
                                    n
                                  
                                
                                
                                  x
                                  
                                    n
                                  
                                
                              
                              
                                
                                  λ
                                  
                                    0
                                  
                                
                                +
                                n
                              
                            
                          
                          )
                        
                        μ
                        +
                        
                          
                            (
                            
                              
                                
                                  
                                    λ
                                    
                                      0
                                    
                                  
                                  
                                    μ
                                    
                                      0
                                    
                                  
                                  +
                                  
                                    ∑
                                    
                                      n
                                      =
                                      1
                                    
                                    
                                      n
                                    
                                  
                                  
                                    x
                                    
                                      n
                                    
                                  
                                
                                
                                  
                                    λ
                                    
                                      0
                                    
                                  
                                  +
                                  n
                                
                              
                            
                            )
                          
                          
                            2
                          
                        
                      
                      )
                    
                  
                  }
                
                +
                
                  c
                  
                    5
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    
                      
                        e
                        
                          τ
                        
                      
                      ⁡
                      [
                      τ
                      ]
                    
                    2
                  
                
                
                  {
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      
                        (
                        
                          μ
                          −
                          
                            
                              
                                
                                  λ
                                  
                                    0
                                  
                                
                                
                                  μ
                                  
                                    0
                                  
                                
                                +
                                
                                  ∑
                                  
                                    n
                                    =
                                    1
                                  
                                  
                                    n
                                  
                                
                                
                                  x
                                  
                                    n
                                  
                                
                              
                              
                                
                                  λ
                                  
                                    0
                                  
                                
                                +
                                n
                              
                            
                          
                        
                        )
                      
                      
                        2
                      
                    
                  
                  }
                
                +
                
                  c
                  
                    5
                  
                
              
            
            
              
              
                
                =
                −
                
                  
                    1
                    2
                  
                
                (
                
                  λ
                  
                    0
                  
                
                +
                n
                )
                
                  e
                  
                    τ
                  
                
                ⁡
                [
                τ
                ]
                
                  
                    (
                    
                      μ
                      −
                      
                        
                          
                            
                              λ
                              
                                0
                              
                            
                            
                              μ
                              
                                0
                              
                            
                            +
                            
                              ∑
                              
                                n
                                =
                                1
                              
                              
                                n
                              
                            
                            
                              x
                              
                                n
                              
                            
                          
                          
                            
                              λ
                              
                                0
                              
                            
                            +
                            n
                          
                        
                      
                    
                    )
                  
                  
                    2
                  
                
                +
                
                  c
                  
                    5
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\ln q_{\mu }^{*}(\mu )&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{\sum _{n=1}^{n}(x_{n}-\mu )^{2}+\lambda _{0}(\mu -\mu _{0})^{2}\right\}+c_{3}\\&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{\sum _{n=1}^{n}(x_{n}^{2}-2x_{n}\mu +\mu ^{2})+\lambda _{0}(\mu ^{2}-2\mu _{0}\mu +\mu _{0}^{2})\right\}+c_{3}\\&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{\left(\sum _{n=1}^{n}x_{n}^{2}\right)-2\left(\sum _{n=1}^{n}x_{n}\right)\mu +\left(\sum _{n=1}^{n}\mu ^{2}\right)+\lambda _{0}\mu ^{2}-2\lambda _{0}\mu _{0}\mu +\lambda _{0}\mu _{0}^{2}\right\}+c_{3}\\&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{(\lambda _{0}+n)\mu ^{2}-2\left(\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}\right)\mu +\left(\sum _{n=1}^{n}x_{n}^{2}\right)+\lambda _{0}\mu _{0}^{2}\right\}+c_{3}\\&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{(\lambda _{0}+n)\mu ^{2}-2\left(\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}\right)\mu \right\}+c_{4}\\&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{(\lambda _{0}+n)\mu ^{2}-2\left({\frac {\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}}{\lambda _{0}+n}}\right)(\lambda _{0}+n)\mu \right\}+c_{4}\\&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{(\lambda _{0}+n)\left(\mu ^{2}-2\left({\frac {\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}}{\lambda _{0}+n}}\right)\mu \right)\right\}+c_{4}\\&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{(\lambda _{0}+n)\left(\mu ^{2}-2\left({\frac {\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}}{\lambda _{0}+n}}\right)\mu +\left({\frac {\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}}{\lambda _{0}+n}}\right)^{2}-\left({\frac {\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}}{\lambda _{0}+n}}\right)^{2}\right)\right\}+c_{4}\\&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{(\lambda _{0}+n)\left(\mu ^{2}-2\left({\frac {\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}}{\lambda _{0}+n}}\right)\mu +\left({\frac {\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}}{\lambda _{0}+n}}\right)^{2}\right)\right\}+c_{5}\\&=-{\frac {\operatorname {e} _{\tau }[\tau ]}{2}}\left\{(\lambda _{0}+n)\left(\mu -{\frac {\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}}{\lambda _{0}+n}}\right)^{2}\right\}+c_{5}\\&=-{\frac {1}{2}}(\lambda _{0}+n)\operatorname {e} _{\tau }[\tau ]\left(\mu -{\frac {\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}}{\lambda _{0}+n}}\right)^{2}+c_{5}\end{aligned}}}
  note that all of the above steps can be shortened by using the formula for the sum of two quadratics.
in other words:

  
    
      
        
          
            
              
                
                  q
                  
                    μ
                  
                  
                    ∗
                  
                
                (
                μ
                )
              
              
                
                ∼
                
                  
                    n
                  
                
                (
                μ
                ∣
                
                  μ
                  
                    n
                  
                
                ,
                
                  λ
                  
                    n
                  
                  
                    −
                    1
                  
                
                )
              
            
            
              
                
                  μ
                  
                    n
                  
                
              
              
                
                =
                
                  
                    
                      
                        λ
                        
                          0
                        
                      
                      
                        μ
                        
                          0
                        
                      
                      +
                      n
                      
                        
                          
                            x
                            ¯
                          
                        
                      
                    
                    
                      
                        λ
                        
                          0
                        
                      
                      +
                      n
                    
                  
                
              
            
            
              
                
                  λ
                  
                    n
                  
                
              
              
                
                =
                (
                
                  λ
                  
                    0
                  
                
                +
                n
                )
                
                  e
                  
                    τ
                  
                
                ⁡
                [
                τ
                ]
              
            
            
              
                
                  
                    
                      x
                      ¯
                    
                  
                
              
              
                
                =
                
                  
                    1
                    n
                  
                
                
                  ∑
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  x
                  
                    n
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}q_{\mu }^{*}(\mu )&\sim {\mathcal {n}}(\mu \mid \mu _{n},\lambda _{n}^{-1})\\\mu _{n}&={\frac {\lambda _{0}\mu _{0}+n{\bar {x}}}{\lambda _{0}+n}}\\\lambda _{n}&=(\lambda _{0}+n)\operatorname {e} _{\tau }[\tau ]\\{\bar {x}}&={\frac {1}{n}}\sum _{n=1}^{n}x_{n}\end{aligned}}}
  


=== derivation of q(τ) ===
the derivation of 
  
    
      
        
          q
          
            τ
          
          
            ∗
          
        
        (
        τ
        )
      
    
    {\displaystyle q_{\tau }^{*}(\tau )}
   is similar to above, although we omit some of the details for the sake of brevity.

  
    
      
        
          
            
              
                ln
                ⁡
                
                  q
                  
                    τ
                  
                  
                    ∗
                  
                
                (
                τ
                )
              
              
                
                =
                
                  e
                  
                    μ
                  
                
                ⁡
                [
                ln
                ⁡
                p
                (
                
                  x
                
                ∣
                μ
                ,
                τ
                )
                +
                ln
                ⁡
                p
                (
                μ
                ∣
                τ
                )
                ]
                +
                ln
                ⁡
                p
                (
                τ
                )
                +
                
                  constant
                
              
            
            
              
              
                
                =
                (
                
                  a
                  
                    0
                  
                
                −
                1
                )
                ln
                ⁡
                τ
                −
                
                  b
                  
                    0
                  
                
                τ
                +
                
                  
                    1
                    2
                  
                
                ln
                ⁡
                τ
                +
                
                  
                    n
                    2
                  
                
                ln
                ⁡
                τ
                −
                
                  
                    τ
                    2
                  
                
                
                  e
                  
                    μ
                  
                
                ⁡
                
                  [
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    (
                    
                      x
                      
                        n
                      
                    
                    −
                    μ
                    
                      )
                      
                        2
                      
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    (
                    μ
                    −
                    
                      μ
                      
                        0
                      
                    
                    
                      )
                      
                        2
                      
                    
                  
                  ]
                
                +
                
                  constant
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\ln q_{\tau }^{*}(\tau )&=\operatorname {e} _{\mu }[\ln p(\mathbf {x} \mid \mu ,\tau )+\ln p(\mu \mid \tau )]+\ln p(\tau )+{\text{constant}}\\&=(a_{0}-1)\ln \tau -b_{0}\tau +{\frac {1}{2}}\ln \tau +{\frac {n}{2}}\ln \tau -{\frac {\tau }{2}}\operatorname {e} _{\mu }\left[\sum _{n=1}^{n}(x_{n}-\mu )^{2}+\lambda _{0}(\mu -\mu _{0})^{2}\right]+{\text{constant}}\end{aligned}}}
  exponentiating both sides, we can see that 
  
    
      
        
          q
          
            τ
          
          
            ∗
          
        
        (
        τ
        )
      
    
    {\displaystyle q_{\tau }^{*}(\tau )}
   is a gamma distribution.  specifically:

  
    
      
        
          
            
              
                
                  q
                  
                    τ
                  
                  
                    ∗
                  
                
                (
                τ
                )
              
              
                
                ∼
                gamma
                ⁡
                (
                τ
                ∣
                
                  a
                  
                    n
                  
                
                ,
                
                  b
                  
                    n
                  
                
                )
              
            
            
              
                
                  a
                  
                    n
                  
                
              
              
                
                =
                
                  a
                  
                    0
                  
                
                +
                
                  
                    
                      n
                      +
                      1
                    
                    2
                  
                
              
            
            
              
                
                  b
                  
                    n
                  
                
              
              
                
                =
                
                  b
                  
                    0
                  
                
                +
                
                  
                    1
                    2
                  
                
                
                  e
                  
                    μ
                  
                
                ⁡
                
                  [
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    (
                    
                      x
                      
                        n
                      
                    
                    −
                    μ
                    
                      )
                      
                        2
                      
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    (
                    μ
                    −
                    
                      μ
                      
                        0
                      
                    
                    
                      )
                      
                        2
                      
                    
                  
                  ]
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}q_{\tau }^{*}(\tau )&\sim \operatorname {gamma} (\tau \mid a_{n},b_{n})\\a_{n}&=a_{0}+{\frac {n+1}{2}}\\b_{n}&=b_{0}+{\frac {1}{2}}\operatorname {e} _{\mu }\left[\sum _{n=1}^{n}(x_{n}-\mu )^{2}+\lambda _{0}(\mu -\mu _{0})^{2}\right]\end{aligned}}}
  


=== algorithm for computing the parameters ===
let us recap the conclusions from the previous sections:

  
    
      
        
          
            
              
                
                  q
                  
                    μ
                  
                  
                    ∗
                  
                
                (
                μ
                )
              
              
                
                ∼
                
                  
                    n
                  
                
                (
                μ
                ∣
                
                  μ
                  
                    n
                  
                
                ,
                
                  λ
                  
                    n
                  
                  
                    −
                    1
                  
                
                )
              
            
            
              
                
                  μ
                  
                    n
                  
                
              
              
                
                =
                
                  
                    
                      
                        λ
                        
                          0
                        
                      
                      
                        μ
                        
                          0
                        
                      
                      +
                      n
                      
                        
                          
                            x
                            ¯
                          
                        
                      
                    
                    
                      
                        λ
                        
                          0
                        
                      
                      +
                      n
                    
                  
                
              
            
            
              
                
                  λ
                  
                    n
                  
                
              
              
                
                =
                (
                
                  λ
                  
                    0
                  
                
                +
                n
                )
                
                  e
                  
                    τ
                  
                
                ⁡
                [
                τ
                ]
              
            
            
              
                
                  
                    
                      x
                      ¯
                    
                  
                
              
              
                
                =
                
                  
                    1
                    n
                  
                
                
                  ∑
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  x
                  
                    n
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}q_{\mu }^{*}(\mu )&\sim {\mathcal {n}}(\mu \mid \mu _{n},\lambda _{n}^{-1})\\\mu _{n}&={\frac {\lambda _{0}\mu _{0}+n{\bar {x}}}{\lambda _{0}+n}}\\\lambda _{n}&=(\lambda _{0}+n)\operatorname {e} _{\tau }[\tau ]\\{\bar {x}}&={\frac {1}{n}}\sum _{n=1}^{n}x_{n}\end{aligned}}}
  and

  
    
      
        
          
            
              
                
                  q
                  
                    τ
                  
                  
                    ∗
                  
                
                (
                τ
                )
              
              
                
                ∼
                gamma
                ⁡
                (
                τ
                ∣
                
                  a
                  
                    n
                  
                
                ,
                
                  b
                  
                    n
                  
                
                )
              
            
            
              
                
                  a
                  
                    n
                  
                
              
              
                
                =
                
                  a
                  
                    0
                  
                
                +
                
                  
                    
                      n
                      +
                      1
                    
                    2
                  
                
              
            
            
              
                
                  b
                  
                    n
                  
                
              
              
                
                =
                
                  b
                  
                    0
                  
                
                +
                
                  
                    1
                    2
                  
                
                
                  e
                  
                    μ
                  
                
                ⁡
                
                  [
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    (
                    
                      x
                      
                        n
                      
                    
                    −
                    μ
                    
                      )
                      
                        2
                      
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    (
                    μ
                    −
                    
                      μ
                      
                        0
                      
                    
                    
                      )
                      
                        2
                      
                    
                  
                  ]
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}q_{\tau }^{*}(\tau )&\sim \operatorname {gamma} (\tau \mid a_{n},b_{n})\\a_{n}&=a_{0}+{\frac {n+1}{2}}\\b_{n}&=b_{0}+{\frac {1}{2}}\operatorname {e} _{\mu }\left[\sum _{n=1}^{n}(x_{n}-\mu )^{2}+\lambda _{0}(\mu -\mu _{0})^{2}\right]\end{aligned}}}
  in each case, the parameters for the distribution over one of the variables depend on expectations taken with respect to the other variable.  we can expand the expectations, using the standard formulas for the expectations of moments of the gaussian and gamma distributions:

  
    
      
        
          
            
              
                e
                ⁡
                [
                τ
                ∣
                
                  a
                  
                    n
                  
                
                ,
                
                  b
                  
                    n
                  
                
                ]
              
              
                
                =
                
                  
                    
                      a
                      
                        n
                      
                    
                    
                      b
                      
                        n
                      
                    
                  
                
              
            
            
              
                e
                ⁡
                
                  [
                  
                    μ
                    ∣
                    
                      μ
                      
                        n
                      
                    
                    ,
                    
                      λ
                      
                        n
                      
                      
                        −
                        1
                      
                    
                  
                  ]
                
              
              
                
                =
                
                  μ
                  
                    n
                  
                
              
            
            
              
                e
                ⁡
                
                  [
                  
                    x
                    
                      2
                    
                  
                  ]
                
              
              
                
                =
                var
                ⁡
                (
                x
                )
                +
                (
                e
                ⁡
                [
                x
                ]
                
                  )
                  
                    2
                  
                
              
            
            
              
                e
                ⁡
                
                  [
                  
                    
                      μ
                      
                        2
                      
                    
                    ∣
                    
                      μ
                      
                        n
                      
                    
                    ,
                    
                      λ
                      
                        n
                      
                      
                        −
                        1
                      
                    
                  
                  ]
                
              
              
                
                =
                
                  λ
                  
                    n
                  
                  
                    −
                    1
                  
                
                +
                
                  μ
                  
                    n
                  
                  
                    2
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\operatorname {e} [\tau \mid a_{n},b_{n}]&={\frac {a_{n}}{b_{n}}}\\\operatorname {e} \left[\mu \mid \mu _{n},\lambda _{n}^{-1}\right]&=\mu _{n}\\\operatorname {e} \left[x^{2}\right]&=\operatorname {var} (x)+(\operatorname {e} [x])^{2}\\\operatorname {e} \left[\mu ^{2}\mid \mu _{n},\lambda _{n}^{-1}\right]&=\lambda _{n}^{-1}+\mu _{n}^{2}\end{aligned}}}
  applying these formulas to the above equations is trivial in most cases, but the equation for 
  
    
      
        
          b
          
            n
          
        
      
    
    {\displaystyle b_{n}}
   takes more work:

  
    
      
        
          
            
              
                
                  b
                  
                    n
                  
                
              
              
                
                =
                
                  b
                  
                    0
                  
                
                +
                
                  
                    1
                    2
                  
                
                
                  e
                  
                    μ
                  
                
                ⁡
                
                  [
                  
                    
                      ∑
                      
                        n
                        =
                        1
                      
                      
                        n
                      
                    
                    (
                    
                      x
                      
                        n
                      
                    
                    −
                    μ
                    
                      )
                      
                        2
                      
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    (
                    μ
                    −
                    
                      μ
                      
                        0
                      
                    
                    
                      )
                      
                        2
                      
                    
                  
                  ]
                
              
            
            
              
              
                
                =
                
                  b
                  
                    0
                  
                
                +
                
                  
                    1
                    2
                  
                
                
                  e
                  
                    μ
                  
                
                ⁡
                
                  [
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      μ
                      
                        2
                      
                    
                    −
                    2
                    
                      (
                      
                        
                          λ
                          
                            0
                          
                        
                        
                          μ
                          
                            0
                          
                        
                        +
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                        
                      
                      )
                    
                    μ
                    +
                    
                      (
                      
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                          
                            2
                          
                        
                      
                      )
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    
                      μ
                      
                        0
                      
                      
                        2
                      
                    
                  
                  ]
                
              
            
            
              
              
                
                =
                
                  b
                  
                    0
                  
                
                +
                
                  
                    1
                    2
                  
                
                
                  [
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      e
                      
                        μ
                      
                    
                    ⁡
                    [
                    
                      μ
                      
                        2
                      
                    
                    ]
                    −
                    2
                    
                      (
                      
                        
                          λ
                          
                            0
                          
                        
                        
                          μ
                          
                            0
                          
                        
                        +
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                        
                      
                      )
                    
                    
                      e
                      
                        μ
                      
                    
                    ⁡
                    [
                    μ
                    ]
                    +
                    
                      (
                      
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                          
                            2
                          
                        
                      
                      )
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    
                      μ
                      
                        0
                      
                      
                        2
                      
                    
                  
                  ]
                
              
            
            
              
              
                
                =
                
                  b
                  
                    0
                  
                
                +
                
                  
                    1
                    2
                  
                
                
                  [
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      (
                      
                        
                          λ
                          
                            n
                          
                          
                            −
                            1
                          
                        
                        +
                        
                          μ
                          
                            n
                          
                          
                            2
                          
                        
                      
                      )
                    
                    −
                    2
                    
                      (
                      
                        
                          λ
                          
                            0
                          
                        
                        
                          μ
                          
                            0
                          
                        
                        +
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                        
                      
                      )
                    
                    
                      μ
                      
                        n
                      
                    
                    +
                    
                      (
                      
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                          
                            2
                          
                        
                      
                      )
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    
                      μ
                      
                        0
                      
                      
                        2
                      
                    
                  
                  ]
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}b_{n}&=b_{0}+{\frac {1}{2}}\operatorname {e} _{\mu }\left[\sum _{n=1}^{n}(x_{n}-\mu )^{2}+\lambda _{0}(\mu -\mu _{0})^{2}\right]\\&=b_{0}+{\frac {1}{2}}\operatorname {e} _{\mu }\left[(\lambda _{0}+n)\mu ^{2}-2\left(\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}\right)\mu +\left(\sum _{n=1}^{n}x_{n}^{2}\right)+\lambda _{0}\mu _{0}^{2}\right]\\&=b_{0}+{\frac {1}{2}}\left[(\lambda _{0}+n)\operatorname {e} _{\mu }[\mu ^{2}]-2\left(\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}\right)\operatorname {e} _{\mu }[\mu ]+\left(\sum _{n=1}^{n}x_{n}^{2}\right)+\lambda _{0}\mu _{0}^{2}\right]\\&=b_{0}+{\frac {1}{2}}\left[(\lambda _{0}+n)\left(\lambda _{n}^{-1}+\mu _{n}^{2}\right)-2\left(\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}\right)\mu _{n}+\left(\sum _{n=1}^{n}x_{n}^{2}\right)+\lambda _{0}\mu _{0}^{2}\right]\\\end{aligned}}}
  we can then write the parameter equations as follows, without any expectations:

  
    
      
        
          
            
              
                
                  μ
                  
                    n
                  
                
              
              
                
                =
                
                  
                    
                      
                        λ
                        
                          0
                        
                      
                      
                        μ
                        
                          0
                        
                      
                      +
                      n
                      
                        
                          
                            x
                            ¯
                          
                        
                      
                    
                    
                      
                        λ
                        
                          0
                        
                      
                      +
                      n
                    
                  
                
              
            
            
              
                
                  λ
                  
                    n
                  
                
              
              
                
                =
                (
                
                  λ
                  
                    0
                  
                
                +
                n
                )
                
                  
                    
                      a
                      
                        n
                      
                    
                    
                      b
                      
                        n
                      
                    
                  
                
              
            
            
              
                
                  
                    
                      x
                      ¯
                    
                  
                
              
              
                
                =
                
                  
                    1
                    n
                  
                
                
                  ∑
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  x
                  
                    n
                  
                
              
            
            
              
                
                  a
                  
                    n
                  
                
              
              
                
                =
                
                  a
                  
                    0
                  
                
                +
                
                  
                    
                      n
                      +
                      1
                    
                    2
                  
                
              
            
            
              
                
                  b
                  
                    n
                  
                
              
              
                
                =
                
                  b
                  
                    0
                  
                
                +
                
                  
                    1
                    2
                  
                
                
                  [
                  
                    (
                    
                      λ
                      
                        0
                      
                    
                    +
                    n
                    )
                    
                      (
                      
                        
                          λ
                          
                            n
                          
                          
                            −
                            1
                          
                        
                        +
                        
                          μ
                          
                            n
                          
                          
                            2
                          
                        
                      
                      )
                    
                    −
                    2
                    
                      (
                      
                        
                          λ
                          
                            0
                          
                        
                        
                          μ
                          
                            0
                          
                        
                        +
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                        
                      
                      )
                    
                    
                      μ
                      
                        n
                      
                    
                    +
                    
                      (
                      
                        
                          ∑
                          
                            n
                            =
                            1
                          
                          
                            n
                          
                        
                        
                          x
                          
                            n
                          
                          
                            2
                          
                        
                      
                      )
                    
                    +
                    
                      λ
                      
                        0
                      
                    
                    
                      μ
                      
                        0
                      
                      
                        2
                      
                    
                  
                  ]
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\mu _{n}&={\frac {\lambda _{0}\mu _{0}+n{\bar {x}}}{\lambda _{0}+n}}\\\lambda _{n}&=(\lambda _{0}+n){\frac {a_{n}}{b_{n}}}\\{\bar {x}}&={\frac {1}{n}}\sum _{n=1}^{n}x_{n}\\a_{n}&=a_{0}+{\frac {n+1}{2}}\\b_{n}&=b_{0}+{\frac {1}{2}}\left[(\lambda _{0}+n)\left(\lambda _{n}^{-1}+\mu _{n}^{2}\right)-2\left(\lambda _{0}\mu _{0}+\sum _{n=1}^{n}x_{n}\right)\mu _{n}+\left(\sum _{n=1}^{n}x_{n}^{2}\right)+\lambda _{0}\mu _{0}^{2}\right]\end{aligned}}}
  note that there are circular dependencies among the formulas for 
  
    
      
        
          λ
          
            n
          
        
      
    
    {\displaystyle \lambda _{n}}
  and 
  
    
      
        
          b
          
            n
          
        
      
    
    {\displaystyle b_{n}}
  .  this naturally suggests an em-like algorithm:

compute 
  
    
      
        
          ∑
          
            n
            =
            1
          
          
            n
          
        
        
          x
          
            n
          
        
      
    
    {\displaystyle \sum _{n=1}^{n}x_{n}}
   and 
  
    
      
        
          ∑
          
            n
            =
            1
          
          
            n
          
        
        
          x
          
            n
          
          
            2
          
        
        .
      
    
    {\displaystyle \sum _{n=1}^{n}x_{n}^{2}.}
   use these values to compute 
  
    
      
        
          μ
          
            n
          
        
      
    
    {\displaystyle \mu _{n}}
   and 
  
    
      
        
          a
          
            n
          
        
        .
      
    
    {\displaystyle a_{n}.}
  
initialize 
  
    
      
        
          λ
          
            n
          
        
      
    
    {\displaystyle \lambda _{n}}
   to some arbitrary value.
use the current value of 
  
    
      
        
          λ
          
            n
          
        
        ,
      
    
    {\displaystyle \lambda _{n},}
   along with the known values of the other parameters, to compute 
  
    
      
        
          b
          
            n
          
        
      
    
    {\displaystyle b_{n}}
  .
use the current value of 
  
    
      
        
          b
          
            n
          
        
        ,
      
    
    {\displaystyle b_{n},}
   along with the known values of the other parameters, to compute 
  
    
      
        
          λ
          
            n
          
        
      
    
    {\displaystyle \lambda _{n}}
  .
repeat the last two steps until convergence (i.e. until neither value has changed more than some small amount).we then have values for the hyperparameters of the approximating distributions of the posterior parameters, which we can use to compute any properties we want of the posterior — e.g. its mean and variance, a 95% highest-density region (the smallest interval that includes 95% of the total probability), etc.
it can be shown that this algorithm is guaranteed to converge to a local maximum.
note also that the posterior distributions have the same form as the corresponding prior distributions.  we did not assume this; the only assumption we made was that the distributions factorize, and the form of the distributions followed naturally.  it turns out (see below) that the fact that the posterior distributions have the same form as the prior distributions is not a coincidence, but a general result whenever the prior distributions are members of the exponential family, which is the case for most of the standard distributions.


== further discussion ==


=== step-by-step recipe ===
the above example shows the method by which the variational-bayesian approximation to a posterior probability density in a given bayesian network is derived:

describe the network with a graphical model, identifying the observed variables (data) 
  
    
      
        
          x
        
      
    
    {\displaystyle \mathbf {x} }
   and unobserved variables (parameters 
  
    
      
        
          θ
        
      
    
    {\displaystyle {\boldsymbol {\theta }}}
   and latent variables 
  
    
      
        
          z
        
      
    
    {\displaystyle \mathbf {z} }
  ) and their conditional probability distributions.  variational bayes will then construct an approximation to the posterior probability 
  
    
      
        p
        (
        
          z
        
        ,
        
          θ
        
        ∣
        
          x
        
        )
      
    
    {\displaystyle p(\mathbf {z} ,{\boldsymbol {\theta }}\mid \mathbf {x} )}
  .  the approximation has the basic property that it is a factorized distribution, i.e. a product of two or more independent distributions over disjoint subsets of the unobserved variables.
partition the unobserved variables into two or more subsets, over which the independent factors will be derived.  there is no universal procedure for doing this; creating too many subsets yields a poor approximation, while creating too few makes the entire variational bayes procedure intractable.  typically, the first split is to separate the parameters and latent variables; often, this is enough by itself to produce a tractable result.  assume that the partitions are called 
  
    
      
        
          
            z
          
          
            1
          
        
        ,
        …
        ,
        
          
            z
          
          
            m
          
        
      
    
    {\displaystyle \mathbf {z} _{1},\ldots ,\mathbf {z} _{m}}
  .
for a given partition 
  
    
      
        
          
            z
          
          
            j
          
        
      
    
    {\displaystyle \mathbf {z} _{j}}
  , write down the formula for the best approximating distribution 
  
    
      
        
          q
          
            j
          
          
            ∗
          
        
        (
        
          
            z
          
          
            j
          
        
        ∣
        
          x
        
        )
      
    
    {\displaystyle q_{j}^{*}(\mathbf {z} _{j}\mid \mathbf {x} )}
   using the basic equation 
  
    
      
        ln
        ⁡
        
          q
          
            j
          
          
            ∗
          
        
        (
        
          
            z
          
          
            j
          
        
        ∣
        
          x
        
        )
        =
        
          e
          
            i
            ≠
            j
          
        
        ⁡
        [
        ln
        ⁡
        p
        (
        
          z
        
        ,
        
          x
        
        )
        ]
        +
        
          constant
        
      
    
    {\displaystyle \ln q_{j}^{*}(\mathbf {z} _{j}\mid \mathbf {x} )=\operatorname {e} _{i\neq j}[\ln p(\mathbf {z} ,\mathbf {x} )]+{\text{constant}}}
   .
fill in the formula for the joint probability distribution using the graphical model.  any component conditional distributions that don't involve any of the variables in 
  
    
      
        
          
            z
          
          
            j
          
        
      
    
    {\displaystyle \mathbf {z} _{j}}
   can be ignored; they will be folded into the constant term.
simplify the formula and apply the expectation operator, following the above example.  ideally, this should simplify into expectations of basic functions of variables not in 
  
    
      
        
          
            z
          
          
            j
          
        
      
    
    {\displaystyle \mathbf {z} _{j}}
   (e.g. first or second raw moments, expectation of a logarithm, etc.).  in order for the variational bayes procedure to work well, these expectations should generally be expressible analytically as functions of the parameters and/or hyperparameters of the distributions of these variables.  in all cases, these expectation terms are constants with respect to the variables in the current partition.
the functional form of the formula with respect to the variables in the current partition indicates the type of distribution.  in particular, exponentiating the formula generates the probability density function (pdf) of the distribution (or at least, something proportional to it, with unknown normalization constant).  in order for the overall method to be tractable, it should be possible to recognize the functional form as belonging to a known distribution.  significant mathematical manipulation may be required to convert the formula into a form that matches the pdf of a known distribution.  when this can be done, the normalization constant can be reinstated by definition, and equations for the parameters of the known distribution can be derived by extracting the appropriate parts of the formula.
when all expectations can be replaced analytically with functions of variables not in the current partition, and the pdf put into a form that allows identification with a known distribution, the result is a set of equations expressing the values of the optimum parameters as functions of the parameters of variables in other partitions.
when this procedure can be applied to all partitions, the result is a set of mutually linked equations specifying the optimum values of all parameters.
an expectation maximization (em) type procedure is then applied, picking an initial value for each parameter and the iterating through a series of steps, where at each step we cycle through the equations, updating each parameter in turn.  this is guaranteed to converge.


=== most important points ===
due to all of the mathematical manipulations involved, it is easy to lose track of the big picture.  the important things are:

the idea of variational bayes is to construct an analytical approximation to the posterior probability of the set of unobserved variables (parameters and latent variables), given the data.  this means that the form of the solution is similar to other bayesian inference methods, such as gibbs sampling — i.e. a distribution that seeks to describe everything that is known about the variables.  as in other bayesian methods — but unlike e.g. in expectation maximization (em) or other maximum likelihood methods — both types of unobserved variables (i.e. parameters and latent variables) are treated the same, i.e. as random variables.  estimates for the variables can then be derived in the standard bayesian ways, e.g. calculating the mean of the distribution to get a single point estimate or deriving a credible interval, highest density region, etc.
"analytical approximation" means that a formula can be written down for the posterior distribution.  the formula generally consists of a product of well-known probability distributions, each of which factorizes over a set of unobserved variables (i.e. it is conditionally independent of the other variables, given the observed data).  this formula is not the true posterior distribution, but an approximation to it; in particular, it will generally agree fairly closely in the lowest moments of the unobserved variables, e.g. the mean and variance.
the result of all of the mathematical manipulations is (1) the identity of the probability distributions making up the factors, and (2) mutually dependent formulas for the parameters of these distributions.  the actual values of these parameters are computed numerically, through an alternating iterative procedure much like em.


=== compared with expectation maximization (em) ===
variational bayes (vb) is often compared with expectation maximization (em).  the actual numerical procedure is quite similar, in that both are alternating iterative procedures that successively converge on optimum parameter values.  the initial steps to derive the respective procedures are also vaguely similar, both starting out with formulas for probability densities and both involving significant amounts of mathematical manipulations.
however, there are a number of differences.  most important is what is being computed.

em computes point estimates of posterior distribution of those random variables that can be categorized as "parameters", but only estimates of the actual posterior distributions of the latent variables (at least in "soft em", and often only when the latent variables are discrete).  the point estimates computed are the modes of these parameters; no other information is available.
vb, on the other hand, computes estimates of the actual posterior distribution of all variables, both parameters and latent variables.  when point estimates need to be derived, generally the mean is used rather than the mode, as is normal in bayesian inference.  concomitant with this, the parameters computed in vb do not have the same significance as those in em.  em computes optimum values of the parameters of the bayes network itself.  vb computes optimum values of the parameters of the distributions used to approximate the parameters and latent variables of the bayes network.  for example, a typical gaussian mixture model will have parameters for the mean and variance of each of the mixture components.  em would directly estimate optimum values for these parameters.  vb, however, would first fit a distribution to these parameters — typically in the form of a prior distribution, e.g. a normal-scaled inverse gamma distribution — and would then compute values for the parameters of this prior distribution, i.e. essentially hyperparameters.  in this case, vb would compute optimum estimates of the four parameters of the normal-scaled inverse gamma distribution that describes the joint distribution of the mean and variance of the component.


== a more complex example ==

imagine a bayesian gaussian mixture model described as follows:

  
    
      
        
          
            
              
                
                  π
                
              
              
                
                ∼
                symdir
                ⁡
                (
                k
                ,
                
                  α
                  
                    0
                  
                
                )
              
            
            
              
                
                  
                    λ
                  
                  
                    i
                    =
                    1
                    …
                    k
                  
                
              
              
                
                ∼
                
                  
                    w
                  
                
                (
                
                  
                    w
                  
                  
                    0
                  
                
                ,
                
                  ν
                  
                    0
                  
                
                )
              
            
            
              
                
                  
                    μ
                  
                  
                    i
                    =
                    1
                    …
                    k
                  
                
              
              
                
                ∼
                
                  
                    n
                  
                
                (
                
                  
                    μ
                  
                  
                    0
                  
                
                ,
                (
                
                  β
                  
                    0
                  
                
                
                  
                    λ
                  
                  
                    i
                  
                
                
                  )
                  
                    −
                    1
                  
                
                )
              
            
            
              
                
                  z
                
                [
                i
                =
                1
                …
                n
                ]
              
              
                
                ∼
                mult
                ⁡
                (
                1
                ,
                
                  π
                
                )
              
            
            
              
                
                  
                    x
                  
                  
                    i
                    =
                    1
                    …
                    n
                  
                
              
              
                
                ∼
                
                  
                    n
                  
                
                (
                
                  
                    μ
                  
                  
                    
                      z
                      
                        i
                      
                    
                  
                
                ,
                
                  
                    
                      
                        λ
                      
                      
                        
                          z
                          
                            i
                          
                        
                      
                    
                  
                  
                    −
                    1
                  
                
                )
              
            
            
              
                k
              
              
                
                =
                
                  number of mixing components
                
              
            
            
              
                n
              
              
                
                =
                
                  number of data points
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\mathbf {\pi } &\sim \operatorname {symdir} (k,\alpha _{0})\\\mathbf {\lambda } _{i=1\dots k}&\sim {\mathcal {w}}(\mathbf {w} _{0},\nu _{0})\\\mathbf {\mu } _{i=1\dots k}&\sim {\mathcal {n}}(\mathbf {\mu } _{0},(\beta _{0}\mathbf {\lambda } _{i})^{-1})\\\mathbf {z} [i=1\dots n]&\sim \operatorname {mult} (1,\mathbf {\pi } )\\\mathbf {x} _{i=1\dots n}&\sim {\mathcal {n}}(\mathbf {\mu } _{z_{i}},{\mathbf {\lambda } _{z_{i}}}^{-1})\\k&={\text{number of mixing components}}\\n&={\text{number of data points}}\end{aligned}}}
  note:

symdir() is the symmetric dirichlet distribution of dimension 
  
    
      
        k
      
    
    {\displaystyle k}
  , with the hyperparameter for each component set to 
  
    
      
        
          α
          
            0
          
        
      
    
    {\displaystyle \alpha _{0}}
  .  the dirichlet distribution is the conjugate prior of the categorical distribution or multinomial distribution.

  
    
      
        
          
            w
          
        
        (
        )
      
    
    {\displaystyle {\mathcal {w}}()}
   is the wishart distribution, which is the conjugate prior of the precision matrix (inverse covariance matrix) for a multivariate gaussian distribution.
mult() is a multinomial distribution over a single observation (equivalent to a categorical distribution).  the state space is a "one-of-k" representation, i.e. a 
  
    
      
        k
      
    
    {\displaystyle k}
  -dimensional vector in which one of the elements is 1 (specifying the identity of the observation) and all other elements are 0.

  
    
      
        
          
            n
          
        
        (
        )
      
    
    {\displaystyle {\mathcal {n}}()}
   is the gaussian distribution, in this case specifically the multivariate gaussian distribution.the interpretation of the above variables is as follows:

  
    
      
        
          x
        
        =
        {
        
          
            x
          
          
            1
          
        
        ,
        …
        ,
        
          
            x
          
          
            n
          
        
        }
      
    
    {\displaystyle \mathbf {x} =\{\mathbf {x} _{1},\dots ,\mathbf {x} _{n}\}}
   is the set of 
  
    
      
        n
      
    
    {\displaystyle n}
   data points, each of which is a 
  
    
      
        d
      
    
    {\displaystyle d}
  -dimensional vector distributed according to a multivariate gaussian distribution.

  
    
      
        
          z
        
        =
        {
        
          
            z
          
          
            1
          
        
        ,
        …
        ,
        
          
            z
          
          
            n
          
        
        }
      
    
    {\displaystyle \mathbf {z} =\{\mathbf {z} _{1},\dots ,\mathbf {z} _{n}\}}
   is a set of latent variables, one per data point, specifying which mixture component the corresponding data point belongs to, using a "one-of-k" vector representation with components 
  
    
      
        
          z
          
            n
            k
          
        
      
    
    {\displaystyle z_{nk}}
   for 
  
    
      
        k
        =
        1
        …
        k
      
    
    {\displaystyle k=1\dots k}
  , as described above.

  
    
      
        
          π
        
      
    
    {\displaystyle \mathbf {\pi } }
   is the mixing proportions for the 
  
    
      
        k
      
    
    {\displaystyle k}
   mixture components.

  
    
      
        
          
            μ
          
          
            i
            =
            1
            …
            k
          
        
      
    
    {\displaystyle \mathbf {\mu } _{i=1\dots k}}
   and 
  
    
      
        
          
            λ
          
          
            i
            =
            1
            …
            k
          
        
      
    
    {\displaystyle \mathbf {\lambda } _{i=1\dots k}}
   specify the parameters (mean and precision) associated with each mixture component.the joint probability of all variables can be rewritten as

  
    
      
        p
        (
        
          x
        
        ,
        
          z
        
        ,
        
          π
        
        ,
        
          μ
        
        ,
        
          λ
        
        )
        =
        p
        (
        
          x
        
        ∣
        
          z
        
        ,
        
          μ
        
        ,
        
          λ
        
        )
        p
        (
        
          z
        
        ∣
        
          π
        
        )
        p
        (
        
          π
        
        )
        p
        (
        
          μ
        
        ∣
        
          λ
        
        )
        p
        (
        
          λ
        
        )
      
    
    {\displaystyle p(\mathbf {x} ,\mathbf {z} ,\mathbf {\pi } ,\mathbf {\mu } ,\mathbf {\lambda } )=p(\mathbf {x} \mid \mathbf {z} ,\mathbf {\mu } ,\mathbf {\lambda } )p(\mathbf {z} \mid \mathbf {\pi } )p(\mathbf {\pi } )p(\mathbf {\mu } \mid \mathbf {\lambda } )p(\mathbf {\lambda } )}
  where the individual factors are

  
    
      
        
          
            
              
                p
                (
                
                  x
                
                ∣
                
                  z
                
                ,
                
                  μ
                
                ,
                
                  λ
                
                )
              
              
                
                =
                
                  ∏
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  ∏
                  
                    k
                    =
                    1
                  
                  
                    k
                  
                
                
                  
                    n
                  
                
                (
                
                  
                    x
                  
                  
                    n
                  
                
                ∣
                
                  
                    μ
                  
                  
                    k
                  
                
                ,
                
                  
                    λ
                  
                  
                    k
                  
                  
                    −
                    1
                  
                
                
                  )
                  
                    
                      z
                      
                        n
                        k
                      
                    
                  
                
              
            
            
              
                p
                (
                
                  z
                
                ∣
                
                  π
                
                )
              
              
                
                =
                
                  ∏
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  ∏
                  
                    k
                    =
                    1
                  
                  
                    k
                  
                
                
                  π
                  
                    k
                  
                  
                    
                      z
                      
                        n
                        k
                      
                    
                  
                
              
            
            
              
                p
                (
                
                  π
                
                )
              
              
                
                =
                
                  
                    
                      γ
                      (
                      k
                      
                        α
                        
                          0
                        
                      
                      )
                    
                    
                      γ
                      (
                      
                        α
                        
                          0
                        
                      
                      
                        )
                        
                          k
                        
                      
                    
                  
                
                
                  ∏
                  
                    k
                    =
                    1
                  
                  
                    k
                  
                
                
                  π
                  
                    k
                  
                  
                    
                      α
                      
                        0
                      
                    
                    −
                    1
                  
                
              
            
            
              
                p
                (
                
                  μ
                
                ∣
                
                  λ
                
                )
              
              
                
                =
                
                  ∏
                  
                    k
                    =
                    1
                  
                  
                    k
                  
                
                
                  
                    n
                  
                
                (
                
                  
                    μ
                  
                  
                    k
                  
                
                ∣
                
                  
                    μ
                  
                  
                    0
                  
                
                ,
                (
                
                  β
                  
                    0
                  
                
                
                  
                    λ
                  
                  
                    k
                  
                
                
                  )
                  
                    −
                    1
                  
                
                )
              
            
            
              
                p
                (
                
                  λ
                
                )
              
              
                
                =
                
                  ∏
                  
                    k
                    =
                    1
                  
                  
                    k
                  
                
                
                  
                    w
                  
                
                (
                
                  
                    λ
                  
                  
                    k
                  
                
                ∣
                
                  
                    w
                  
                  
                    0
                  
                
                ,
                
                  ν
                  
                    0
                  
                
                )
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}p(\mathbf {x} \mid \mathbf {z} ,\mathbf {\mu } ,\mathbf {\lambda } )&=\prod _{n=1}^{n}\prod _{k=1}^{k}{\mathcal {n}}(\mathbf {x} _{n}\mid \mathbf {\mu } _{k},\mathbf {\lambda } _{k}^{-1})^{z_{nk}}\\p(\mathbf {z} \mid \mathbf {\pi } )&=\prod _{n=1}^{n}\prod _{k=1}^{k}\pi _{k}^{z_{nk}}\\p(\mathbf {\pi } )&={\frac {\gamma (k\alpha _{0})}{\gamma (\alpha _{0})^{k}}}\prod _{k=1}^{k}\pi _{k}^{\alpha _{0}-1}\\p(\mathbf {\mu } \mid \mathbf {\lambda } )&=\prod _{k=1}^{k}{\mathcal {n}}(\mathbf {\mu } _{k}\mid \mathbf {\mu } _{0},(\beta _{0}\mathbf {\lambda } _{k})^{-1})\\p(\mathbf {\lambda } )&=\prod _{k=1}^{k}{\mathcal {w}}(\mathbf {\lambda } _{k}\mid \mathbf {w} _{0},\nu _{0})\end{aligned}}}
  where

  
    
      
        
          
            
              
                
                  
                    n
                  
                
                (
                
                  x
                
                ∣
                
                  μ
                
                ,
                
                  σ
                
                )
              
              
                
                =
                
                  
                    1
                    
                      (
                      2
                      π
                      
                        )
                        
                          d
                          
                            /
                          
                          2
                        
                      
                    
                  
                
                
                  
                    1
                    
                      
                        |
                      
                      
                        σ
                      
                      
                        
                          |
                        
                        
                          1
                          
                            /
                          
                          2
                        
                      
                    
                  
                
                exp
                ⁡
                
                  {
                  
                    −
                    
                      
                        1
                        2
                      
                    
                    (
                    
                      x
                    
                    −
                    
                      μ
                    
                    
                      )
                      
                        
                          t
                        
                      
                    
                    
                      
                        σ
                      
                      
                        −
                        1
                      
                    
                    (
                    
                      x
                    
                    −
                    
                      μ
                    
                    )
                  
                  }
                
              
            
            
              
                
                  
                    w
                  
                
                (
                
                  λ
                
                ∣
                
                  w
                
                ,
                ν
                )
              
              
                
                =
                b
                (
                
                  w
                
                ,
                ν
                )
                
                  |
                
                
                  λ
                
                
                  
                    |
                  
                  
                    (
                    ν
                    −
                    d
                    −
                    1
                    )
                    
                      /
                    
                    2
                  
                
                exp
                ⁡
                
                  (
                  
                    −
                    
                      
                        1
                        2
                      
                    
                    tr
                    ⁡
                    (
                    
                      
                        w
                      
                      
                        −
                        1
                      
                    
                    
                      λ
                    
                    )
                  
                  )
                
              
            
            
              
                b
                (
                
                  w
                
                ,
                ν
                )
              
              
                
                =
                
                  |
                
                
                  w
                
                
                  
                    |
                  
                  
                    −
                    ν
                    
                      /
                    
                    2
                  
                
                
                  
                    {
                    
                      
                        2
                        
                          ν
                          d
                          
                            /
                          
                          2
                        
                      
                      
                        π
                        
                          d
                          (
                          d
                          −
                          1
                          )
                          
                            /
                          
                          4
                        
                      
                      
                        ∏
                        
                          i
                          =
                          1
                        
                        
                          d
                        
                      
                      γ
                      
                        (
                        
                          
                            
                              ν
                              +
                              1
                              −
                              i
                            
                            2
                          
                        
                        )
                      
                    
                    }
                  
                  
                    −
                    1
                  
                
              
            
            
              
                d
              
              
                
                =
                
                  dimensionality of each data point
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}{\mathcal {n}}(\mathbf {x} \mid \mathbf {\mu } ,\mathbf {\sigma } )&={\frac {1}{(2\pi )^{d/2}}}{\frac {1}{|\mathbf {\sigma } |^{1/2}}}\exp \left\{-{\frac {1}{2}}(\mathbf {x} -\mathbf {\mu } )^{\rm {t}}\mathbf {\sigma } ^{-1}(\mathbf {x} -\mathbf {\mu } )\right\}\\{\mathcal {w}}(\mathbf {\lambda } \mid \mathbf {w} ,\nu )&=b(\mathbf {w} ,\nu )|\mathbf {\lambda } |^{(\nu -d-1)/2}\exp \left(-{\frac {1}{2}}\operatorname {tr} (\mathbf {w} ^{-1}\mathbf {\lambda } )\right)\\b(\mathbf {w} ,\nu )&=|\mathbf {w} |^{-\nu /2}\left\{2^{\nu d/2}\pi ^{d(d-1)/4}\prod _{i=1}^{d}\gamma \left({\frac {\nu +1-i}{2}}\right)\right\}^{-1}\\d&={\text{dimensionality of each data point}}\end{aligned}}}
  assume that 
  
    
      
        q
        (
        
          z
        
        ,
        
          π
        
        ,
        
          μ
        
        ,
        
          λ
        
        )
        =
        q
        (
        
          z
        
        )
        q
        (
        
          π
        
        ,
        
          μ
        
        ,
        
          λ
        
        )
      
    
    {\displaystyle q(\mathbf {z} ,\mathbf {\pi } ,\mathbf {\mu } ,\mathbf {\lambda } )=q(\mathbf {z} )q(\mathbf {\pi } ,\mathbf {\mu } ,\mathbf {\lambda } )}
  .
then

  
    
      
        
          
            
              
                ln
                ⁡
                
                  q
                  
                    ∗
                  
                
                (
                
                  z
                
                )
              
              
                
                =
                
                  e
                  
                    
                      π
                    
                    ,
                    
                      μ
                    
                    ,
                    
                      λ
                    
                  
                
                ⁡
                [
                ln
                ⁡
                p
                (
                
                  x
                
                ,
                
                  z
                
                ,
                
                  π
                
                ,
                
                  μ
                
                ,
                
                  λ
                
                )
                ]
                +
                
                  constant
                
              
            
            
              
              
                
                =
                
                  e
                  
                    
                      π
                    
                  
                
                ⁡
                [
                ln
                ⁡
                p
                (
                
                  z
                
                ∣
                
                  π
                
                )
                ]
                +
                
                  e
                  
                    
                      μ
                    
                    ,
                    
                      λ
                    
                  
                
                ⁡
                [
                ln
                ⁡
                p
                (
                
                  x
                
                ∣
                
                  z
                
                ,
                
                  μ
                
                ,
                
                  λ
                
                )
                ]
                +
                
                  constant
                
              
            
            
              
              
                
                =
                
                  ∑
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  ∑
                  
                    k
                    =
                    1
                  
                  
                    k
                  
                
                
                  z
                  
                    n
                    k
                  
                
                ln
                ⁡
                
                  ρ
                  
                    n
                    k
                  
                
                +
                
                  constant
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\ln q^{*}(\mathbf {z} )&=\operatorname {e} _{\mathbf {\pi } ,\mathbf {\mu } ,\mathbf {\lambda } }[\ln p(\mathbf {x} ,\mathbf {z} ,\mathbf {\pi } ,\mathbf {\mu } ,\mathbf {\lambda } )]+{\text{constant}}\\&=\operatorname {e} _{\mathbf {\pi } }[\ln p(\mathbf {z} \mid \mathbf {\pi } )]+\operatorname {e} _{\mathbf {\mu } ,\mathbf {\lambda } }[\ln p(\mathbf {x} \mid \mathbf {z} ,\mathbf {\mu } ,\mathbf {\lambda } )]+{\text{constant}}\\&=\sum _{n=1}^{n}\sum _{k=1}^{k}z_{nk}\ln \rho _{nk}+{\text{constant}}\end{aligned}}}
  where we have defined

  
    
      
        ln
        ⁡
        
          ρ
          
            n
            k
          
        
        =
        e
        ⁡
        [
        ln
        ⁡
        
          π
          
            k
          
        
        ]
        +
        
          
            1
            2
          
        
        e
        ⁡
        [
        ln
        ⁡
        
          |
        
        
          
            λ
          
          
            k
          
        
        
          |
        
        ]
        −
        
          
            d
            2
          
        
        ln
        ⁡
        (
        2
        π
        )
        −
        
          
            1
            2
          
        
        
          e
          
            
              
                μ
              
              
                k
              
            
            ,
            
              
                λ
              
              
                k
              
            
          
        
        ⁡
        [
        (
        
          
            x
          
          
            n
          
        
        −
        
          
            μ
          
          
            k
          
        
        
          )
          
            
              t
            
          
        
        
          
            λ
          
          
            k
          
        
        (
        
          
            x
          
          
            n
          
        
        −
        
          
            μ
          
          
            k
          
        
        )
        ]
      
    
    {\displaystyle \ln \rho _{nk}=\operatorname {e} [\ln \pi _{k}]+{\frac {1}{2}}\operatorname {e} [\ln |\mathbf {\lambda } _{k}|]-{\frac {d}{2}}\ln(2\pi )-{\frac {1}{2}}\operatorname {e} _{\mathbf {\mu } _{k},\mathbf {\lambda } _{k}}[(\mathbf {x} _{n}-\mathbf {\mu } _{k})^{\rm {t}}\mathbf {\lambda } _{k}(\mathbf {x} _{n}-\mathbf {\mu } _{k})]}
  exponentiating both sides of the formula for 
  
    
      
        ln
        ⁡
        
          q
          
            ∗
          
        
        (
        
          z
        
        )
      
    
    {\displaystyle \ln q^{*}(\mathbf {z} )}
   yields

  
    
      
        
          q
          
            ∗
          
        
        (
        
          z
        
        )
        ∝
        
          ∏
          
            n
            =
            1
          
          
            n
          
        
        
          ∏
          
            k
            =
            1
          
          
            k
          
        
        
          ρ
          
            n
            k
          
          
            
              z
              
                n
                k
              
            
          
        
      
    
    {\displaystyle q^{*}(\mathbf {z} )\propto \prod _{n=1}^{n}\prod _{k=1}^{k}\rho _{nk}^{z_{nk}}}
  requiring that this be normalized ends up requiring that the 
  
    
      
        
          ρ
          
            n
            k
          
        
      
    
    {\displaystyle \rho _{nk}}
   sum to 1 over all values of 
  
    
      
        k
      
    
    {\displaystyle k}
  , yielding

  
    
      
        
          q
          
            ∗
          
        
        (
        
          z
        
        )
        =
        
          ∏
          
            n
            =
            1
          
          
            n
          
        
        
          ∏
          
            k
            =
            1
          
          
            k
          
        
        
          r
          
            n
            k
          
          
            
              z
              
                n
                k
              
            
          
        
      
    
    {\displaystyle q^{*}(\mathbf {z} )=\prod _{n=1}^{n}\prod _{k=1}^{k}r_{nk}^{z_{nk}}}
  where

  
    
      
        
          r
          
            n
            k
          
        
        =
        
          
            
              ρ
              
                n
                k
              
            
            
              
                ∑
                
                  j
                  =
                  1
                
                
                  k
                
              
              
                ρ
                
                  n
                  j
                
              
            
          
        
      
    
    {\displaystyle r_{nk}={\frac {\rho _{nk}}{\sum _{j=1}^{k}\rho _{nj}}}}
  in other words, 
  
    
      
        
          q
          
            ∗
          
        
        (
        
          z
        
        )
      
    
    {\displaystyle q^{*}(\mathbf {z} )}
   is a product of single-observation multinomial distributions, and factors over each individual 
  
    
      
        
          
            z
          
          
            n
          
        
      
    
    {\displaystyle \mathbf {z} _{n}}
  , which is distributed as a single-observation multinomial distribution with parameters 
  
    
      
        
          r
          
            n
            k
          
        
      
    
    {\displaystyle r_{nk}}
   for 
  
    
      
        k
        =
        1
        …
        k
      
    
    {\displaystyle k=1\dots k}
  .
furthermore, we note that

  
    
      
        e
        ⁡
        [
        
          z
          
            n
            k
          
        
        ]
        =
        
          r
          
            n
            k
          
        
        
      
    
    {\displaystyle \operatorname {e} [z_{nk}]=r_{nk}\,}
  which is a standard result for categorical distributions.
now, considering the factor 
  
    
      
        q
        (
        
          π
        
        ,
        
          μ
        
        ,
        
          λ
        
        )
      
    
    {\displaystyle q(\mathbf {\pi } ,\mathbf {\mu } ,\mathbf {\lambda } )}
  , note that it automatically factors into 
  
    
      
        q
        (
        
          π
        
        )
        
          ∏
          
            k
            =
            1
          
          
            k
          
        
        q
        (
        
          
            μ
          
          
            k
          
        
        ,
        
          
            λ
          
          
            k
          
        
        )
      
    
    {\displaystyle q(\mathbf {\pi } )\prod _{k=1}^{k}q(\mathbf {\mu } _{k},\mathbf {\lambda } _{k})}
   due to the structure of the graphical model defining our gaussian mixture model, which is specified above.
then,

  
    
      
        
          
            
              
                ln
                ⁡
                
                  q
                  
                    ∗
                  
                
                (
                
                  π
                
                )
              
              
                
                =
                ln
                ⁡
                p
                (
                
                  π
                
                )
                +
                
                  e
                  
                    
                      z
                    
                  
                
                ⁡
                [
                ln
                ⁡
                p
                (
                
                  z
                
                ∣
                
                  π
                
                )
                ]
                +
                
                  constant
                
              
            
            
              
              
                
                =
                (
                
                  α
                  
                    0
                  
                
                −
                1
                )
                
                  ∑
                  
                    k
                    =
                    1
                  
                  
                    k
                  
                
                ln
                ⁡
                
                  π
                  
                    k
                  
                
                +
                
                  ∑
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  ∑
                  
                    k
                    =
                    1
                  
                  
                    k
                  
                
                
                  r
                  
                    n
                    k
                  
                
                ln
                ⁡
                
                  π
                  
                    k
                  
                
                +
                
                  constant
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\ln q^{*}(\mathbf {\pi } )&=\ln p(\mathbf {\pi } )+\operatorname {e} _{\mathbf {z} }[\ln p(\mathbf {z} \mid \mathbf {\pi } )]+{\text{constant}}\\&=(\alpha _{0}-1)\sum _{k=1}^{k}\ln \pi _{k}+\sum _{n=1}^{n}\sum _{k=1}^{k}r_{nk}\ln \pi _{k}+{\text{constant}}\end{aligned}}}
  taking the exponential of both sides, we recognize 
  
    
      
        
          q
          
            ∗
          
        
        (
        
          π
        
        )
      
    
    {\displaystyle q^{*}(\mathbf {\pi } )}
   as a dirichlet distribution

  
    
      
        
          q
          
            ∗
          
        
        (
        
          π
        
        )
        ∼
        dir
        ⁡
        (
        
          α
        
        )
        
      
    
    {\displaystyle q^{*}(\mathbf {\pi } )\sim \operatorname {dir} (\mathbf {\alpha } )\,}
  where

  
    
      
        
          α
          
            k
          
        
        =
        
          α
          
            0
          
        
        +
        
          n
          
            k
          
        
        
      
    
    {\displaystyle \alpha _{k}=\alpha _{0}+n_{k}\,}
  where

  
    
      
        
          n
          
            k
          
        
        =
        
          ∑
          
            n
            =
            1
          
          
            n
          
        
        
          r
          
            n
            k
          
        
        
      
    
    {\displaystyle n_{k}=\sum _{n=1}^{n}r_{nk}\,}
  finally

  
    
      
        ln
        ⁡
        
          q
          
            ∗
          
        
        (
        
          
            μ
          
          
            k
          
        
        ,
        
          
            λ
          
          
            k
          
        
        )
        =
        ln
        ⁡
        p
        (
        
          
            μ
          
          
            k
          
        
        ,
        
          
            λ
          
          
            k
          
        
        )
        +
        
          ∑
          
            n
            =
            1
          
          
            n
          
        
        e
        ⁡
        [
        
          z
          
            n
            k
          
        
        ]
        ln
        ⁡
        
          
            n
          
        
        (
        
          
            x
          
          
            n
          
        
        ∣
        
          
            μ
          
          
            k
          
        
        ,
        
          
            λ
          
          
            k
          
          
            −
            1
          
        
        )
        +
        
          constant
        
      
    
    {\displaystyle \ln q^{*}(\mathbf {\mu } _{k},\mathbf {\lambda } _{k})=\ln p(\mathbf {\mu } _{k},\mathbf {\lambda } _{k})+\sum _{n=1}^{n}\operatorname {e} [z_{nk}]\ln {\mathcal {n}}(\mathbf {x} _{n}\mid \mathbf {\mu } _{k},\mathbf {\lambda } _{k}^{-1})+{\text{constant}}}
  grouping and reading off terms involving 
  
    
      
        
          
            μ
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {\mu } _{k}}
   and 
  
    
      
        
          
            λ
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {\lambda } _{k}}
  , the result is a gaussian-wishart distribution given by

  
    
      
        
          q
          
            ∗
          
        
        (
        
          
            μ
          
          
            k
          
        
        ,
        
          
            λ
          
          
            k
          
        
        )
        =
        
          
            n
          
        
        (
        
          
            μ
          
          
            k
          
        
        ∣
        
          
            m
          
          
            k
          
        
        ,
        (
        
          β
          
            k
          
        
        
          
            λ
          
          
            k
          
        
        
          )
          
            −
            1
          
        
        )
        
          
            w
          
        
        (
        
          
            λ
          
          
            k
          
        
        ∣
        
          
            w
          
          
            k
          
        
        ,
        
          ν
          
            k
          
        
        )
      
    
    {\displaystyle q^{*}(\mathbf {\mu } _{k},\mathbf {\lambda } _{k})={\mathcal {n}}(\mathbf {\mu } _{k}\mid \mathbf {m} _{k},(\beta _{k}\mathbf {\lambda } _{k})^{-1}){\mathcal {w}}(\mathbf {\lambda } _{k}\mid \mathbf {w} _{k},\nu _{k})}
  given the definitions

  
    
      
        
          
            
              
                
                  β
                  
                    k
                  
                
              
              
                
                =
                
                  β
                  
                    0
                  
                
                +
                
                  n
                  
                    k
                  
                
              
            
            
              
                
                  
                    m
                  
                  
                    k
                  
                
              
              
                
                =
                
                  
                    1
                    
                      β
                      
                        k
                      
                    
                  
                
                (
                
                  β
                  
                    0
                  
                
                
                  
                    μ
                  
                  
                    0
                  
                
                +
                
                  n
                  
                    k
                  
                
                
                  
                    
                      
                        
                          x
                        
                        ¯
                      
                    
                  
                  
                    k
                  
                
                )
              
            
            
              
                
                  
                    w
                  
                  
                    k
                  
                  
                    −
                    1
                  
                
              
              
                
                =
                
                  
                    w
                  
                  
                    0
                  
                  
                    −
                    1
                  
                
                +
                
                  n
                  
                    k
                  
                
                
                  
                    s
                  
                  
                    k
                  
                
                +
                
                  
                    
                      
                        β
                        
                          0
                        
                      
                      
                        n
                        
                          k
                        
                      
                    
                    
                      
                        β
                        
                          0
                        
                      
                      +
                      
                        n
                        
                          k
                        
                      
                    
                  
                
                (
                
                  
                    
                      
                        
                          x
                        
                        ¯
                      
                    
                  
                  
                    k
                  
                
                −
                
                  
                    μ
                  
                  
                    0
                  
                
                )
                (
                
                  
                    
                      
                        
                          x
                        
                        ¯
                      
                    
                  
                  
                    k
                  
                
                −
                
                  
                    μ
                  
                  
                    0
                  
                
                
                  )
                  
                    
                      t
                    
                  
                
              
            
            
              
                
                  ν
                  
                    k
                  
                
              
              
                
                =
                
                  ν
                  
                    0
                  
                
                +
                
                  n
                  
                    k
                  
                
              
            
            
              
                
                  n
                  
                    k
                  
                
              
              
                
                =
                
                  ∑
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  r
                  
                    n
                    k
                  
                
              
            
            
              
                
                  
                    
                      
                        
                          x
                        
                        ¯
                      
                    
                  
                  
                    k
                  
                
              
              
                
                =
                
                  
                    1
                    
                      n
                      
                        k
                      
                    
                  
                
                
                  ∑
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  r
                  
                    n
                    k
                  
                
                
                  
                    x
                  
                  
                    n
                  
                
              
            
            
              
                
                  
                    s
                  
                  
                    k
                  
                
              
              
                
                =
                
                  
                    1
                    
                      n
                      
                        k
                      
                    
                  
                
                
                  ∑
                  
                    n
                    =
                    1
                  
                  
                    n
                  
                
                
                  r
                  
                    n
                    k
                  
                
                (
                
                  
                    x
                  
                  
                    n
                  
                
                −
                
                  
                    
                      
                        
                          x
                        
                        ¯
                      
                    
                  
                  
                    k
                  
                
                )
                (
                
                  
                    x
                  
                  
                    n
                  
                
                −
                
                  
                    
                      
                        
                          x
                        
                        ¯
                      
                    
                  
                  
                    k
                  
                
                
                  )
                  
                    
                      t
                    
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\beta _{k}&=\beta _{0}+n_{k}\\\mathbf {m} _{k}&={\frac {1}{\beta _{k}}}(\beta _{0}\mathbf {\mu } _{0}+n_{k}{\bar {\mathbf {x} }}_{k})\\\mathbf {w} _{k}^{-1}&=\mathbf {w} _{0}^{-1}+n_{k}\mathbf {s} _{k}+{\frac {\beta _{0}n_{k}}{\beta _{0}+n_{k}}}({\bar {\mathbf {x} }}_{k}-\mathbf {\mu } _{0})({\bar {\mathbf {x} }}_{k}-\mathbf {\mu } _{0})^{\rm {t}}\\\nu _{k}&=\nu _{0}+n_{k}\\n_{k}&=\sum _{n=1}^{n}r_{nk}\\{\bar {\mathbf {x} }}_{k}&={\frac {1}{n_{k}}}\sum _{n=1}^{n}r_{nk}\mathbf {x} _{n}\\\mathbf {s} _{k}&={\frac {1}{n_{k}}}\sum _{n=1}^{n}r_{nk}(\mathbf {x} _{n}-{\bar {\mathbf {x} }}_{k})(\mathbf {x} _{n}-{\bar {\mathbf {x} }}_{k})^{\rm {t}}\end{aligned}}}
  finally, notice that these functions require the values of 
  
    
      
        
          r
          
            n
            k
          
        
      
    
    {\displaystyle r_{nk}}
  , which make use of 
  
    
      
        
          ρ
          
            n
            k
          
        
      
    
    {\displaystyle \rho _{nk}}
  , which is defined in turn based on 
  
    
      
        e
        ⁡
        [
        ln
        ⁡
        
          π
          
            k
          
        
        ]
      
    
    {\displaystyle \operatorname {e} [\ln \pi _{k}]}
  , 
  
    
      
        e
        ⁡
        [
        ln
        ⁡
        
          |
        
        
          
            λ
          
          
            k
          
        
        
          |
        
        ]
      
    
    {\displaystyle \operatorname {e} [\ln |\mathbf {\lambda } _{k}|]}
  , and 
  
    
      
        
          e
          
            
              
                μ
              
              
                k
              
            
            ,
            
              
                λ
              
              
                k
              
            
          
        
        ⁡
        [
        (
        
          
            x
          
          
            n
          
        
        −
        
          
            μ
          
          
            k
          
        
        
          )
          
            
              t
            
          
        
        
          
            λ
          
          
            k
          
        
        (
        
          
            x
          
          
            n
          
        
        −
        
          
            μ
          
          
            k
          
        
        )
        ]
      
    
    {\displaystyle \operatorname {e} _{\mathbf {\mu } _{k},\mathbf {\lambda } _{k}}[(\mathbf {x} _{n}-\mathbf {\mu } _{k})^{\rm {t}}\mathbf {\lambda } _{k}(\mathbf {x} _{n}-\mathbf {\mu } _{k})]}
  .  now that we have determined the distributions over which these expectations are taken, we can derive formulas for them:

  
    
      
        
          
            
              
                
                  e
                  
                    
                      
                        μ
                      
                      
                        k
                      
                    
                    ,
                    
                      
                        λ
                      
                      
                        k
                      
                    
                  
                
                ⁡
                [
                (
                
                  
                    x
                  
                  
                    n
                  
                
                −
                
                  
                    μ
                  
                  
                    k
                  
                
                
                  )
                  
                    
                      t
                    
                  
                
                
                  
                    λ
                  
                  
                    k
                  
                
                (
                
                  
                    x
                  
                  
                    n
                  
                
                −
                
                  
                    μ
                  
                  
                    k
                  
                
                )
                ]
              
              
                
                =
                d
                
                  β
                  
                    k
                  
                  
                    −
                    1
                  
                
                +
                
                  ν
                  
                    k
                  
                
                (
                
                  
                    x
                  
                  
                    n
                  
                
                −
                
                  
                    m
                  
                  
                    k
                  
                
                
                  )
                  
                    
                      t
                    
                  
                
                
                  
                    w
                  
                  
                    k
                  
                
                (
                
                  
                    x
                  
                  
                    n
                  
                
                −
                
                  
                    m
                  
                  
                    k
                  
                
                )
              
            
            
              
                ln
                ⁡
                
                  
                    
                      
                        λ
                        ~
                      
                    
                  
                  
                    k
                  
                
              
              
                
                ≡
                e
                ⁡
                [
                ln
                ⁡
                
                  |
                
                
                  
                    λ
                  
                  
                    k
                  
                
                
                  |
                
                ]
                =
                
                  ∑
                  
                    i
                    =
                    1
                  
                  
                    d
                  
                
                ψ
                
                  (
                  
                    
                      
                        
                          ν
                          
                            k
                          
                        
                        +
                        1
                        −
                        i
                      
                      2
                    
                  
                  )
                
                +
                d
                ln
                ⁡
                2
                +
                ln
                ⁡
                
                  |
                
                
                  
                    w
                  
                  
                    k
                  
                
                
                  |
                
              
            
            
              
                ln
                ⁡
                
                  
                    
                      
                        π
                        ~
                      
                    
                  
                  
                    k
                  
                
              
              
                
                ≡
                e
                ⁡
                
                  [
                  
                    ln
                    ⁡
                    
                      |
                    
                    
                      π
                      
                        k
                      
                    
                    
                      |
                    
                  
                  ]
                
                =
                ψ
                (
                
                  α
                  
                    k
                  
                
                )
                −
                ψ
                
                  (
                  
                    
                      ∑
                      
                        i
                        =
                        1
                      
                      
                        k
                      
                    
                    
                      α
                      
                        i
                      
                    
                  
                  )
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\operatorname {e} _{\mathbf {\mu } _{k},\mathbf {\lambda } _{k}}[(\mathbf {x} _{n}-\mathbf {\mu } _{k})^{\rm {t}}\mathbf {\lambda } _{k}(\mathbf {x} _{n}-\mathbf {\mu } _{k})]&=d\beta _{k}^{-1}+\nu _{k}(\mathbf {x} _{n}-\mathbf {m} _{k})^{\rm {t}}\mathbf {w} _{k}(\mathbf {x} _{n}-\mathbf {m} _{k})\\\ln {\widetilde {\lambda }}_{k}&\equiv \operatorname {e} [\ln |\mathbf {\lambda } _{k}|]=\sum _{i=1}^{d}\psi \left({\frac {\nu _{k}+1-i}{2}}\right)+d\ln 2+\ln |\mathbf {w} _{k}|\\\ln {\widetilde {\pi }}_{k}&\equiv \operatorname {e} \left[\ln |\pi _{k}|\right]=\psi (\alpha _{k})-\psi \left(\sum _{i=1}^{k}\alpha _{i}\right)\end{aligned}}}
  these results lead to

  
    
      
        
          r
          
            n
            k
          
        
        ∝
        
          
            
              
                π
                ~
              
            
          
          
            k
          
        
        
          
            
              
                λ
                ~
              
            
          
          
            k
          
          
            1
            
              /
            
            2
          
        
        exp
        ⁡
        
          {
          
            −
            
              
                d
                
                  2
                  
                    β
                    
                      k
                    
                  
                
              
            
            −
            
              
                
                  ν
                  
                    k
                  
                
                2
              
            
            (
            
              
                x
              
              
                n
              
            
            −
            
              
                m
              
              
                k
              
            
            
              )
              
                
                  t
                
              
            
            
              
                w
              
              
                k
              
            
            (
            
              
                x
              
              
                n
              
            
            −
            
              
                m
              
              
                k
              
            
            )
          
          }
        
      
    
    {\displaystyle r_{nk}\propto {\widetilde {\pi }}_{k}{\widetilde {\lambda }}_{k}^{1/2}\exp \left\{-{\frac {d}{2\beta _{k}}}-{\frac {\nu _{k}}{2}}(\mathbf {x} _{n}-\mathbf {m} _{k})^{\rm {t}}\mathbf {w} _{k}(\mathbf {x} _{n}-\mathbf {m} _{k})\right\}}
  these can be converted from proportional to absolute values by normalizing over 
  
    
      
        k
      
    
    {\displaystyle k}
   so that the corresponding values sum to 1.
note that:

the update equations for the parameters 
  
    
      
        
          β
          
            k
          
        
      
    
    {\displaystyle \beta _{k}}
  , 
  
    
      
        
          
            m
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {m} _{k}}
  , 
  
    
      
        
          
            w
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {w} _{k}}
   and 
  
    
      
        
          ν
          
            k
          
        
      
    
    {\displaystyle \nu _{k}}
   of the variables 
  
    
      
        
          
            μ
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {\mu } _{k}}
   and 
  
    
      
        
          
            λ
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {\lambda } _{k}}
   depend on the statistics 
  
    
      
        
          n
          
            k
          
        
      
    
    {\displaystyle n_{k}}
  , 
  
    
      
        
          
            
              
                
                  x
                
                ¯
              
            
          
          
            k
          
        
      
    
    {\displaystyle {\bar {\mathbf {x} }}_{k}}
  , and 
  
    
      
        
          
            s
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {s} _{k}}
  , and these statistics in turn depend on 
  
    
      
        
          r
          
            n
            k
          
        
      
    
    {\displaystyle r_{nk}}
  .
the update equations for the parameters 
  
    
      
        
          α
          
            1
            …
            k
          
        
      
    
    {\displaystyle \alpha _{1\dots k}}
   of the variable 
  
    
      
        
          π
        
      
    
    {\displaystyle \mathbf {\pi } }
   depend on the statistic 
  
    
      
        
          n
          
            k
          
        
      
    
    {\displaystyle n_{k}}
  , which depends in turn on 
  
    
      
        
          r
          
            n
            k
          
        
      
    
    {\displaystyle r_{nk}}
  .
the update equation for 
  
    
      
        
          r
          
            n
            k
          
        
      
    
    {\displaystyle r_{nk}}
   has a direct circular dependence on 
  
    
      
        
          β
          
            k
          
        
      
    
    {\displaystyle \beta _{k}}
  , 
  
    
      
        
          
            m
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {m} _{k}}
  , 
  
    
      
        
          
            w
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {w} _{k}}
   and 
  
    
      
        
          ν
          
            k
          
        
      
    
    {\displaystyle \nu _{k}}
   as well as an indirect circular dependence on 
  
    
      
        
          
            w
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {w} _{k}}
  , 
  
    
      
        
          ν
          
            k
          
        
      
    
    {\displaystyle \nu _{k}}
   and 
  
    
      
        
          α
          
            1
            …
            k
          
        
      
    
    {\displaystyle \alpha _{1\dots k}}
   through 
  
    
      
        
          
            
              
                π
                ~
              
            
          
          
            k
          
        
      
    
    {\displaystyle {\widetilde {\pi }}_{k}}
   and 
  
    
      
        
          
            
              
                λ
                ~
              
            
          
          
            k
          
        
      
    
    {\displaystyle {\widetilde {\lambda }}_{k}}
  .this suggests an iterative procedure that alternates between two steps:

an e-step that computes the value of 
  
    
      
        
          r
          
            n
            k
          
        
      
    
    {\displaystyle r_{nk}}
   using the current values of all the other parameters.
an m-step that uses the new value of 
  
    
      
        
          r
          
            n
            k
          
        
      
    
    {\displaystyle r_{nk}}
   to compute new values of all the other parameters.note that these steps correspond closely with the standard em algorithm to derive a maximum likelihood or maximum a posteriori (map) solution for the parameters of a gaussian mixture model.  the responsibilities 
  
    
      
        
          r
          
            n
            k
          
        
      
    
    {\displaystyle r_{nk}}
   in the e step correspond closely to the posterior probabilities of the latent variables given the data, i.e. 
  
    
      
        p
        (
        
          z
        
        ∣
        
          x
        
        )
      
    
    {\displaystyle p(\mathbf {z} \mid \mathbf {x} )}
  ; the computation of the statistics 
  
    
      
        
          n
          
            k
          
        
      
    
    {\displaystyle n_{k}}
  , 
  
    
      
        
          
            
              
                
                  x
                
                ¯
              
            
          
          
            k
          
        
      
    
    {\displaystyle {\bar {\mathbf {x} }}_{k}}
  , and 
  
    
      
        
          
            s
          
          
            k
          
        
      
    
    {\displaystyle \mathbf {s} _{k}}
   corresponds closely to the computation of corresponding "soft-count" statistics over the data; and the use of those statistics to compute new values of the parameters corresponds closely to the use of soft counts to compute new parameter values in normal em over a gaussian mixture model.


== exponential-family distributions ==
note that in the previous example, once the distribution over unobserved variables was assumed to factorize into distributions over the "parameters" and distributions over the "latent data", the derived "best" distribution for each variable was in the same family as the corresponding prior distribution over the variable.  this is a general result that holds true for all prior distributions derived from the exponential family.


== see also ==
variational message passing: a modular algorithm for variational bayesian inference.
expectation-maximization algorithm: a related approach which corresponds to a special case of variational bayesian inference.
generalized filtering: a variational filtering scheme for nonlinear state space models.
calculus of variations: the field of mathematical analysis that deals with maximizing or minimizing functionals.
maximum entropy discrimination: this is a variational inference framework that allows for introducing and accounting for additional large-margin constraints


== references ==


== external links ==
the on-line textbook: information theory, inference, and learning algorithms, by david j.c. mackay provides an introduction to variational methods (p. 422).
a tutorial on variational bayes. fox, c. and roberts, s. 2012. artificial intelligence review, doi:10.1007/s10462-011-9236-8.
variational-bayes repository a repository of research papers, software, and links related to the use of variational methods for approximate bayesian learning up to 2003.
variational algorithms for approximate bayesian inference, by m. j. beal includes comparisons of em to variational bayesian em and derivations of several models including variational bayesian hmms.
high-level explanation of variational inference by jason eisner may be worth reading before a more mathematically detailed treatment.
copula variational bayes inference via information geometry (pdf) by tran, v.h. 2018. this paper is primarily written for students. via bregman divergence, the paper shows that variational bayes is simply a generalized pythagorean projection of true model onto an arbitrarily correlated (copula) distributional space, of which the independent space is merely a special case.