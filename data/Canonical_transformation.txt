in hamiltonian mechanics, a canonical transformation is a change of canonical coordinates (q, p, t) → (q, p, t) that preserves the form of hamilton's equations. this is sometimes known as form invariance. it need not preserve the form of the hamiltonian itself. canonical transformations are useful in their own right, and also form the basis for the hamilton–jacobi equations (a useful method for calculating conserved quantities) and liouville's theorem (itself the basis for classical statistical mechanics).
since lagrangian mechanics is based on generalized coordinates, transformations of the coordinates q → q do not affect the form of lagrange's equations and, hence, do not affect the form of hamilton's equations if we simultaneously change the momentum by a legendre transformation into

  
    
      
        
          p
          
            i
          
        
        =
        
          
            
              ∂
              l
            
            
              ∂
              
                
                  
                    
                      q
                      ˙
                    
                  
                
                
                  i
                
              
            
          
        
        .
      
    
    {\displaystyle p_{i}={\frac {\partial l}{\partial {\dot {q}}_{i}}}.}
  therefore, coordinate transformations (also called point transformations) are a type of canonical transformation. however, the class of canonical transformations is much broader, since the old generalized coordinates, momenta and even time may be combined to form the new generalized coordinates and momenta.  canonical transformations that do not include the time explicitly are called restricted canonical transformations (many textbooks consider only this type).
for clarity, we restrict the presentation here to calculus and classical mechanics.  readers familiar with more advanced mathematics such as cotangent bundles, exterior derivatives and symplectic manifolds should read the related symplectomorphism article.  (canonical transformations are a special case of a symplectomorphism.)  however, a brief introduction to the modern mathematical description is included at the end of this article.


== notation ==
boldface variables such as q represent a list of n generalized coordinates that need not transform like a vector under rotation, e.g.,

  
    
      
        
          q
        
        ≡
        
          (
          
            
              q
              
                1
              
            
            ,
            
              q
              
                2
              
            
            ,
            …
            ,
            
              q
              
                n
                −
                1
              
            
            ,
            
              q
              
                n
              
            
          
          )
        
        .
      
    
    {\displaystyle \mathbf {q} \equiv \left(q_{1},q_{2},\ldots ,q_{n-1},q_{n}\right).}
  a dot over a variable or list signifies the time derivative, e.g.,

  
    
      
        
          
            
              
                q
              
              ˙
            
          
        
        ≡
        
          
            
              d
              
                q
              
            
            
              d
              t
            
          
        
        .
      
    
    {\displaystyle {\dot {\mathbf {q} }}\equiv {\frac {d\mathbf {q} }{dt}}.}
  the dot product notation between two lists of the same number of coordinates is a shorthand for the sum of the products of corresponding components, e.g.,

  
    
      
        
          p
        
        ⋅
        
          q
        
        ≡
        
          ∑
          
            k
            =
            1
          
          
            n
          
        
        
          p
          
            k
          
        
        
          q
          
            k
          
        
        .
      
    
    {\displaystyle \mathbf {p} \cdot \mathbf {q} \equiv \sum _{k=1}^{n}p_{k}q_{k}.}
  the dot product (also known as an "inner product") maps the two coordinate lists into one variable representing a single numerical value.


== direct approach ==
the functional form of hamilton's equations is

  
    
      
        
          
            
              
                
                  
                    
                      
                        p
                      
                      ˙
                    
                  
                
              
              
                
                =
                −
                
                  
                    
                      ∂
                      h
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
              
            
            
              
                
                  
                    
                      
                        q
                      
                      ˙
                    
                  
                
              
              
                
                =
                
                  
                    
                      ∂
                      h
                    
                    
                      ∂
                      
                        p
                      
                    
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}{\dot {\mathbf {p} }}&=-{\frac {\partial h}{\partial \mathbf {q} }}\\{\dot {\mathbf {q} }}&={\frac {\partial h}{\partial \mathbf {p} }}\end{aligned}}}
  by definition, the transformed coordinates have analogous dynamics

  
    
      
        
          
            
              
                
                  
                    
                      
                        p
                      
                      ˙
                    
                  
                
              
              
                
                =
                −
                
                  
                    
                      ∂
                      k
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
              
            
            
              
                
                  
                    
                      
                        q
                      
                      ˙
                    
                  
                
              
              
                
                =
                
                  
                    
                      ∂
                      k
                    
                    
                      ∂
                      
                        p
                      
                    
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}{\dot {\mathbf {p} }}&=-{\frac {\partial k}{\partial \mathbf {q} }}\\{\dot {\mathbf {q} }}&={\frac {\partial k}{\partial \mathbf {p} }}\end{aligned}}}
  where k(q, p) is a new hamiltonian (sometimes called the kamiltonian) that must be determined.
in general, a  transformation (q, p, t) → (q, p, t) does not preserve the form of hamilton's equations.  for time independent transformations between (q, p) and (q, p) we may check if the transformation is restricted canonical, as follows.  since restricted transformations have no explicit time dependence (by definition), the time derivative of a new generalized coordinate qm is

  
    
      
        
          
            
              
                
                  
                    
                      
                        q
                        ˙
                      
                    
                  
                  
                    m
                  
                
              
              
                
                =
                
                  
                    
                      ∂
                      
                        q
                        
                          m
                        
                      
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
                ⋅
                
                  
                    
                      
                        q
                      
                      ˙
                    
                  
                
                +
                
                  
                    
                      ∂
                      
                        q
                        
                          m
                        
                      
                    
                    
                      ∂
                      
                        p
                      
                    
                  
                
                ⋅
                
                  
                    
                      
                        p
                      
                      ˙
                    
                  
                
              
            
            
              
              
                
                =
                
                  
                    
                      ∂
                      
                        q
                        
                          m
                        
                      
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
                ⋅
                
                  
                    
                      ∂
                      h
                    
                    
                      ∂
                      
                        p
                      
                    
                  
                
                −
                
                  
                    
                      ∂
                      
                        q
                        
                          m
                        
                      
                    
                    
                      ∂
                      
                        p
                      
                    
                  
                
                ⋅
                
                  
                    
                      ∂
                      h
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
              
            
            
              
              
                
                =
                {
                
                  q
                  
                    m
                  
                
                ,
                h
                }
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}{\dot {q}}_{m}&={\frac {\partial q_{m}}{\partial \mathbf {q} }}\cdot {\dot {\mathbf {q} }}+{\frac {\partial q_{m}}{\partial \mathbf {p} }}\cdot {\dot {\mathbf {p} }}\\&={\frac {\partial q_{m}}{\partial \mathbf {q} }}\cdot {\frac {\partial h}{\partial \mathbf {p} }}-{\frac {\partial q_{m}}{\partial \mathbf {p} }}\cdot {\frac {\partial h}{\partial \mathbf {q} }}\\&=\lbrace q_{m},h\rbrace \end{aligned}}}
  where {⋅, ⋅}  is the poisson bracket.
we also have the identity for the conjugate momentum pm

  
    
      
        
          
            
              ∂
              h
            
            
              ∂
              
                p
                
                  m
                
              
            
          
        
        =
        
          
            
              ∂
              h
            
            
              ∂
              
                q
              
            
          
        
        ⋅
        
          
            
              ∂
              
                q
              
            
            
              ∂
              
                p
                
                  m
                
              
            
          
        
        +
        
          
            
              ∂
              h
            
            
              ∂
              
                p
              
            
          
        
        ⋅
        
          
            
              ∂
              
                p
              
            
            
              ∂
              
                p
                
                  m
                
              
            
          
        
      
    
    {\displaystyle {\frac {\partial h}{\partial p_{m}}}={\frac {\partial h}{\partial \mathbf {q} }}\cdot {\frac {\partial \mathbf {q} }{\partial p_{m}}}+{\frac {\partial h}{\partial \mathbf {p} }}\cdot {\frac {\partial \mathbf {p} }{\partial p_{m}}}}
  if the transformation is canonical, these two must be equal, resulting in the equations

  
    
      
        
          
            
              
                
                  
                    (
                    
                      
                        
                          ∂
                          
                            q
                            
                              m
                            
                          
                        
                        
                          ∂
                          
                            p
                            
                              n
                            
                          
                        
                      
                    
                    )
                  
                  
                    
                      q
                    
                    ,
                    
                      p
                    
                  
                
              
              
                
                =
                −
                
                  
                    (
                    
                      
                        
                          ∂
                          
                            q
                            
                              n
                            
                          
                        
                        
                          ∂
                          
                            p
                            
                              m
                            
                          
                        
                      
                    
                    )
                  
                  
                    
                      q
                    
                    ,
                    
                      p
                    
                  
                
              
            
            
              
                
                  
                    (
                    
                      
                        
                          ∂
                          
                            q
                            
                              m
                            
                          
                        
                        
                          ∂
                          
                            q
                            
                              n
                            
                          
                        
                      
                    
                    )
                  
                  
                    
                      q
                    
                    ,
                    
                      p
                    
                  
                
              
              
                
                =
                
                  
                    (
                    
                      
                        
                          ∂
                          
                            p
                            
                              n
                            
                          
                        
                        
                          ∂
                          
                            p
                            
                              m
                            
                          
                        
                      
                    
                    )
                  
                  
                    
                      q
                    
                    ,
                    
                      p
                    
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\left({\frac {\partial q_{m}}{\partial p_{n}}}\right)_{\mathbf {q} ,\mathbf {p} }&=-\left({\frac {\partial q_{n}}{\partial p_{m}}}\right)_{\mathbf {q} ,\mathbf {p} }\\\left({\frac {\partial q_{m}}{\partial q_{n}}}\right)_{\mathbf {q} ,\mathbf {p} }&=\left({\frac {\partial p_{n}}{\partial p_{m}}}\right)_{\mathbf {q} ,\mathbf {p} }\end{aligned}}}
  the analogous argument for the generalized momenta pm leads to two other sets of equations

  
    
      
        
          
            
              
                
                  
                    (
                    
                      
                        
                          ∂
                          
                            p
                            
                              m
                            
                          
                        
                        
                          ∂
                          
                            p
                            
                              n
                            
                          
                        
                      
                    
                    )
                  
                  
                    
                      q
                    
                    ,
                    
                      p
                    
                  
                
              
              
                
                =
                
                  
                    (
                    
                      
                        
                          ∂
                          
                            q
                            
                              n
                            
                          
                        
                        
                          ∂
                          
                            q
                            
                              m
                            
                          
                        
                      
                    
                    )
                  
                  
                    
                      q
                    
                    ,
                    
                      p
                    
                  
                
              
            
            
              
                
                  
                    (
                    
                      
                        
                          ∂
                          
                            p
                            
                              m
                            
                          
                        
                        
                          ∂
                          
                            q
                            
                              n
                            
                          
                        
                      
                    
                    )
                  
                  
                    
                      q
                    
                    ,
                    
                      p
                    
                  
                
              
              
                
                =
                −
                
                  
                    (
                    
                      
                        
                          ∂
                          
                            p
                            
                              n
                            
                          
                        
                        
                          ∂
                          
                            q
                            
                              m
                            
                          
                        
                      
                    
                    )
                  
                  
                    
                      q
                    
                    ,
                    
                      p
                    
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\left({\frac {\partial p_{m}}{\partial p_{n}}}\right)_{\mathbf {q} ,\mathbf {p} }&=\left({\frac {\partial q_{n}}{\partial q_{m}}}\right)_{\mathbf {q} ,\mathbf {p} }\\\left({\frac {\partial p_{m}}{\partial q_{n}}}\right)_{\mathbf {q} ,\mathbf {p} }&=-\left({\frac {\partial p_{n}}{\partial q_{m}}}\right)_{\mathbf {q} ,\mathbf {p} }\end{aligned}}}
  these are the direct conditions to check whether a given transformation is canonical.


== liouville's theorem ==
the direct conditions allow us to prove liouville's theorem, which states that the volume in  phase space is conserved under canonical transformations, i.e.,

  
    
      
        ∫
        
          d
        
        
          q
        
        
        
          d
        
        
          p
        
        =
        ∫
        
          d
        
        
          q
        
        
        
          d
        
        
          p
        
      
    
    {\displaystyle \int \mathrm {d} \mathbf {q} \,\mathrm {d} \mathbf {p} =\int \mathrm {d} \mathbf {q} \,\mathrm {d} \mathbf {p} }
  by calculus, the latter integral must equal the former times the jacobian j

  
    
      
        ∫
        
          d
        
        
          q
        
        
        
          d
        
        
          p
        
        =
        ∫
        j
        
        
          d
        
        
          q
        
        
        
          d
        
        
          p
        
      
    
    {\displaystyle \int \mathrm {d} \mathbf {q} \,\mathrm {d} \mathbf {p} =\int j\,\mathrm {d} \mathbf {q} \,\mathrm {d} \mathbf {p} }
  where the jacobian is the determinant of the matrix of partial derivatives, which we write as

  
    
      
        j
        ≡
        
          
            
              ∂
              (
              
                q
              
              ,
              
                p
              
              )
            
            
              ∂
              (
              
                q
              
              ,
              
                p
              
              )
            
          
        
      
    
    {\displaystyle j\equiv {\frac {\partial (\mathbf {q} ,\mathbf {p} )}{\partial (\mathbf {q} ,\mathbf {p} )}}}
  exploiting the "division" property of jacobians yields

  
    
      
        j
        ≡
        
          
            
              ∂
              (
              
                q
              
              ,
              
                p
              
              )
            
            
              ∂
              (
              
                q
              
              ,
              
                p
              
              )
            
          
        
        
          /
          
            
              
                ∂
                (
                
                  q
                
                ,
                
                  p
                
                )
              
              
                ∂
                (
                
                  q
                
                ,
                
                  p
                
                )
              
            
          
          
        
      
    
    {\displaystyle j\equiv {\frac {\partial (\mathbf {q} ,\mathbf {p} )}{\partial (\mathbf {q} ,\mathbf {p} )}}\left/{\frac {\partial (\mathbf {q} ,\mathbf {p} )}{\partial (\mathbf {q} ,\mathbf {p} )}}\right.}
  eliminating the repeated variables gives

  
    
      
        j
        ≡
        
          
            
              ∂
              (
              
                q
              
              )
            
            
              ∂
              (
              
                q
              
              )
            
          
        
        
          /
          
            
              
                ∂
                (
                
                  p
                
                )
              
              
                ∂
                (
                
                  p
                
                )
              
            
          
          
        
      
    
    {\displaystyle j\equiv {\frac {\partial (\mathbf {q} )}{\partial (\mathbf {q} )}}\left/{\frac {\partial (\mathbf {p} )}{\partial (\mathbf {p} )}}\right.}
  application of the direct conditions above yields j = 1.


== generating function approach ==

to guarantee a valid transformation between (q, p, h) and (q, p, k), we may resort to an indirect generating function approach. both sets of variables must obey hamilton's principle. that is the action integral over the lagrangian 
  
    
      
        
          
            
              l
            
          
          
            q
            p
          
        
        =
        
          p
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
        −
        h
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
      
    
    {\displaystyle {\mathcal {l}}_{qp}=\mathbf {p} \cdot {\dot {\mathbf {q} }}-h(\mathbf {q} ,\mathbf {p} ,t)}
   and 
  
    
      
        
          
            
              l
            
          
          
            q
            p
          
        
        =
        
          p
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
        −
        k
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
      
    
    {\displaystyle {\mathcal {l}}_{qp}=\mathbf {p} \cdot {\dot {\mathbf {q} }}-k(\mathbf {q} ,\mathbf {p} ,t)}
   respectively, obtained by the hamiltonian via ("inverse") legendre transformation, both must be stationary (so that one can use the euler–lagrange equations to arrive at equations of the above-mentioned and designated form; as it is shown for example here):

  
    
      
        
          
            
              
                δ
                
                  ∫
                  
                    
                      t
                      
                        1
                      
                    
                  
                  
                    
                      t
                      
                        2
                      
                    
                  
                
                
                  [
                  
                    
                      p
                    
                    ⋅
                    
                      
                        
                          
                            q
                          
                          ˙
                        
                      
                    
                    −
                    h
                    (
                    
                      q
                    
                    ,
                    
                      p
                    
                    ,
                    t
                    )
                  
                  ]
                
                d
                t
              
              
                
                =
                0
              
            
            
              
                δ
                
                  ∫
                  
                    
                      t
                      
                        1
                      
                    
                  
                  
                    
                      t
                      
                        2
                      
                    
                  
                
                
                  [
                  
                    
                      p
                    
                    ⋅
                    
                      
                        
                          
                            q
                          
                          ˙
                        
                      
                    
                    −
                    k
                    (
                    
                      q
                    
                    ,
                    
                      p
                    
                    ,
                    t
                    )
                  
                  ]
                
                d
                t
              
              
                
                =
                0
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\delta \int _{t_{1}}^{t_{2}}\left[\mathbf {p} \cdot {\dot {\mathbf {q} }}-h(\mathbf {q} ,\mathbf {p} ,t)\right]dt&=0\\\delta \int _{t_{1}}^{t_{2}}\left[\mathbf {p} \cdot {\dot {\mathbf {q} }}-k(\mathbf {q} ,\mathbf {p} ,t)\right]dt&=0\end{aligned}}}
  one way for both variational integral equalities to be satisfied is to have

  
    
      
        λ
        
          [
          
            
              p
            
            ⋅
            
              
                
                  
                    q
                  
                  ˙
                
              
            
            −
            h
            (
            
              q
            
            ,
            
              p
            
            ,
            t
            )
          
          ]
        
        =
        
          p
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
        −
        k
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
        +
        
          
            
              d
              g
            
            
              d
              t
            
          
        
      
    
    {\displaystyle \lambda \left[\mathbf {p} \cdot {\dot {\mathbf {q} }}-h(\mathbf {q} ,\mathbf {p} ,t)\right]=\mathbf {p} \cdot {\dot {\mathbf {q} }}-k(\mathbf {q} ,\mathbf {p} ,t)+{\frac {dg}{dt}}}
  lagrangians are not unique: one can always multiply by a constant λ and add a total time derivative dg/dt and yield the same equations of motion (see for reference: [1]).
in general, the scaling factor λ is set equal to one; canonical transformations for which λ ≠ 1 are called extended canonical transformations. dg/dt is kept, otherwise the problem would be rendered trivial and there would be not much freedom for the new canonical variables to differ from the old ones.
here g is a generating function of one old canonical coordinate (q or p), one new canonical coordinate (q or p) and (possibly) the time t.  thus, there are four basic types of generating functions (although mixtures of these four types can exist), depending on the choice of variables. as will be shown below, the generating function will define a transformation from old to new canonical coordinates, and any such transformation (q, p) → (q, p) is guaranteed to be canonical.


=== type 1 generating function ===
the type 1 generating function g1 depends only on the old and new generalized coordinates

  
    
      
        g
        ≡
        
          g
          
            1
          
        
        (
        
          q
        
        ,
        
          q
        
        ,
        t
        )
      
    
    {\displaystyle g\equiv g_{1}(\mathbf {q} ,\mathbf {q} ,t)}
  to derive the implicit transformation, we expand the defining equation above

  
    
      
        
          p
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
        −
        h
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
        =
        
          p
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
        −
        k
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
        +
        
          
            
              ∂
              
                g
                
                  1
                
              
            
            
              ∂
              t
            
          
        
        +
        
          
            
              ∂
              
                g
                
                  1
                
              
            
            
              ∂
              
                q
              
            
          
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
        +
        
          
            
              ∂
              
                g
                
                  1
                
              
            
            
              ∂
              
                q
              
            
          
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
      
    
    {\displaystyle \mathbf {p} \cdot {\dot {\mathbf {q} }}-h(\mathbf {q} ,\mathbf {p} ,t)=\mathbf {p} \cdot {\dot {\mathbf {q} }}-k(\mathbf {q} ,\mathbf {p} ,t)+{\frac {\partial g_{1}}{\partial t}}+{\frac {\partial g_{1}}{\partial \mathbf {q} }}\cdot {\dot {\mathbf {q} }}+{\frac {\partial g_{1}}{\partial \mathbf {q} }}\cdot {\dot {\mathbf {q} }}}
  since the new and old coordinates are each independent, the following 2n + 1 equations must hold

  
    
      
        
          
            
              
                
                  p
                
              
              
                
                =
                
                  
                    
                      ∂
                      
                        g
                        
                          1
                        
                      
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
              
            
            
              
                
                  p
                
              
              
                
                =
                −
                
                  
                    
                      ∂
                      
                        g
                        
                          1
                        
                      
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
              
            
            
              
                k
              
              
                
                =
                h
                +
                
                  
                    
                      ∂
                      
                        g
                        
                          1
                        
                      
                    
                    
                      ∂
                      t
                    
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\mathbf {p} &={\frac {\partial g_{1}}{\partial \mathbf {q} }}\\\mathbf {p} &=-{\frac {\partial g_{1}}{\partial \mathbf {q} }}\\k&=h+{\frac {\partial g_{1}}{\partial t}}\end{aligned}}}
  these equations define the transformation (q, p) → (q, p) as follows.   the first set of n equations

  
    
      
        
          p
        
        =
        
          
            
              ∂
              
                g
                
                  1
                
              
            
            
              ∂
              
                q
              
            
          
        
      
    
    {\displaystyle \mathbf {p} ={\frac {\partial g_{1}}{\partial \mathbf {q} }}}
  define relations between the new generalized coordinates q and the old canonical coordinates (q, p). ideally, one can invert these relations to obtain formulae for each qk as a function of the old canonical coordinates.  substitution of these formulae for the q coordinates into the second set of n equations

  
    
      
        
          p
        
        =
        −
        
          
            
              ∂
              
                g
                
                  1
                
              
            
            
              ∂
              
                q
              
            
          
        
      
    
    {\displaystyle \mathbf {p} =-{\frac {\partial g_{1}}{\partial \mathbf {q} }}}
  yields analogous formulae for the new generalized momenta p in terms of the old canonical coordinates (q, p).  we then invert both sets of formulae to obtain the old canonical coordinates (q, p) as functions of the new canonical coordinates (q, p).  substitution of the inverted formulae into the final equation 

  
    
      
        k
        =
        h
        +
        
          
            
              ∂
              
                g
                
                  1
                
              
            
            
              ∂
              t
            
          
        
      
    
    {\displaystyle k=h+{\frac {\partial g_{1}}{\partial t}}}
  yields a formula for k as a function of the new canonical coordinates (q, p).
in practice, this procedure is easier than it sounds, because the generating function is usually simple.  for example, let 

  
    
      
        
          g
          
            1
          
        
        ≡
        
          q
        
        ⋅
        
          q
        
      
    
    {\displaystyle g_{1}\equiv \mathbf {q} \cdot \mathbf {q} }
  this results in swapping the generalized coordinates for the momenta and vice versa 

  
    
      
        
          
            
              
                
                  p
                
              
              
                
                =
                
                  
                    
                      ∂
                      
                        g
                        
                          1
                        
                      
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
                =
                
                  q
                
              
            
            
              
                
                  p
                
              
              
                
                =
                −
                
                  
                    
                      ∂
                      
                        g
                        
                          1
                        
                      
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
                =
                −
                
                  q
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\mathbf {p} &={\frac {\partial g_{1}}{\partial \mathbf {q} }}=\mathbf {q} \\\mathbf {p} &=-{\frac {\partial g_{1}}{\partial \mathbf {q} }}=-\mathbf {q} \end{aligned}}}
  and k = h.  this example illustrates how independent the coordinates and momenta are in the hamiltonian formulation; they are equivalent variables.


=== type 2 generating function ===
the type 2 generating function g2 depends only on the old generalized coordinates and the new generalized momenta

  
    
      
        g
        ≡
        −
        
          q
        
        ⋅
        
          p
        
        +
        
          g
          
            2
          
        
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
      
    
    {\displaystyle g\equiv -\mathbf {q} \cdot \mathbf {p} +g_{2}(\mathbf {q} ,\mathbf {p} ,t)}
  where the 
  
    
      
        −
        
          q
        
        ⋅
        
          p
        
      
    
    {\displaystyle -\mathbf {q} \cdot \mathbf {p} }
   terms represent a legendre transformation to change the right-hand side of the equation below.  to derive the implicit transformation, we expand the defining equation above

  
    
      
        
          p
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
        −
        h
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
        =
        −
        
          q
        
        ⋅
        
          
            
              
                p
              
              ˙
            
          
        
        −
        k
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
        +
        
          
            
              ∂
              
                g
                
                  2
                
              
            
            
              ∂
              t
            
          
        
        +
        
          
            
              ∂
              
                g
                
                  2
                
              
            
            
              ∂
              
                q
              
            
          
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
        +
        
          
            
              ∂
              
                g
                
                  2
                
              
            
            
              ∂
              
                p
              
            
          
        
        ⋅
        
          
            
              
                p
              
              ˙
            
          
        
      
    
    {\displaystyle \mathbf {p} \cdot {\dot {\mathbf {q} }}-h(\mathbf {q} ,\mathbf {p} ,t)=-\mathbf {q} \cdot {\dot {\mathbf {p} }}-k(\mathbf {q} ,\mathbf {p} ,t)+{\frac {\partial g_{2}}{\partial t}}+{\frac {\partial g_{2}}{\partial \mathbf {q} }}\cdot {\dot {\mathbf {q} }}+{\frac {\partial g_{2}}{\partial \mathbf {p} }}\cdot {\dot {\mathbf {p} }}}
  since the old coordinates and new momenta are each independent, the following 2n + 1 equations must hold

  
    
      
        
          
            
              
                
                  p
                
              
              
                
                =
                
                  
                    
                      ∂
                      
                        g
                        
                          2
                        
                      
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
              
            
            
              
                
                  q
                
              
              
                
                =
                
                  
                    
                      ∂
                      
                        g
                        
                          2
                        
                      
                    
                    
                      ∂
                      
                        p
                      
                    
                  
                
              
            
            
              
                k
              
              
                
                =
                h
                +
                
                  
                    
                      ∂
                      
                        g
                        
                          2
                        
                      
                    
                    
                      ∂
                      t
                    
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\mathbf {p} &={\frac {\partial g_{2}}{\partial \mathbf {q} }}\\\mathbf {q} &={\frac {\partial g_{2}}{\partial \mathbf {p} }}\\k&=h+{\frac {\partial g_{2}}{\partial t}}\end{aligned}}}
  these equations define the transformation (q, p) → (q, p) as follows.   the first set of n equations

  
    
      
        
          p
        
        =
        
          
            
              ∂
              
                g
                
                  2
                
              
            
            
              ∂
              
                q
              
            
          
        
      
    
    {\displaystyle \mathbf {p} ={\frac {\partial g_{2}}{\partial \mathbf {q} }}}
  define relations between the new generalized momenta p and the old canonical coordinates (q, p). ideally, one can invert these relations to obtain formulae for each pk as a function of the old canonical coordinates.  substitution of these formulae for the p coordinates into the second set of n equations

  
    
      
        
          q
        
        =
        
          
            
              ∂
              
                g
                
                  2
                
              
            
            
              ∂
              
                p
              
            
          
        
      
    
    {\displaystyle \mathbf {q} ={\frac {\partial g_{2}}{\partial \mathbf {p} }}}
  yields analogous formulae for the new generalized coordinates q in terms of the old canonical coordinates (q, p). we then invert both sets of formulae to obtain the old canonical coordinates (q, p) as functions of the new canonical coordinates (q, p).  substitution of the inverted formulae into the final equation 

  
    
      
        k
        =
        h
        +
        
          
            
              ∂
              
                g
                
                  2
                
              
            
            
              ∂
              t
            
          
        
      
    
    {\displaystyle k=h+{\frac {\partial g_{2}}{\partial t}}}
  yields a formula for k as a function of the new canonical coordinates (q, p).
in practice, this procedure is easier than it sounds, because the generating function is usually simple.  for example, let 

  
    
      
        
          g
          
            2
          
        
        ≡
        
          g
        
        (
        
          q
        
        ;
        t
        )
        ⋅
        
          p
        
      
    
    {\displaystyle g_{2}\equiv \mathbf {g} (\mathbf {q} ;t)\cdot \mathbf {p} }
  where g is a set of n functions.  this results in a point transformation of the generalized coordinates

  
    
      
        
          q
        
        =
        
          
            
              ∂
              
                g
                
                  2
                
              
            
            
              ∂
              
                p
              
            
          
        
        =
        
          g
        
        (
        
          q
        
        ;
        t
        )
      
    
    {\displaystyle \mathbf {q} ={\frac {\partial g_{2}}{\partial \mathbf {p} }}=\mathbf {g} (\mathbf {q} ;t)}
  


=== type 3 generating function ===
the type 3 generating function g3 depends only on the old generalized momenta and the new generalized coordinates 

  
    
      
        g
        ≡
        
          q
        
        ⋅
        
          p
        
        +
        
          g
          
            3
          
        
        (
        
          p
        
        ,
        
          q
        
        ,
        t
        )
      
    
    {\displaystyle g\equiv \mathbf {q} \cdot \mathbf {p} +g_{3}(\mathbf {p} ,\mathbf {q} ,t)}
  where the 
  
    
      
        
          q
        
        ⋅
        
          p
        
      
    
    {\displaystyle \mathbf {q} \cdot \mathbf {p} }
   terms represent a legendre transformation to change the left-hand side of the equation below.  to derive the implicit transformation, we expand the defining equation above

  
    
      
        −
        
          q
        
        ⋅
        
          
            
              
                p
              
              ˙
            
          
        
        −
        h
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
        =
        
          p
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
        −
        k
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
        +
        
          
            
              ∂
              
                g
                
                  3
                
              
            
            
              ∂
              t
            
          
        
        +
        
          
            
              ∂
              
                g
                
                  3
                
              
            
            
              ∂
              
                p
              
            
          
        
        ⋅
        
          
            
              
                p
              
              ˙
            
          
        
        +
        
          
            
              ∂
              
                g
                
                  3
                
              
            
            
              ∂
              
                q
              
            
          
        
        ⋅
        
          
            
              
                q
              
              ˙
            
          
        
      
    
    {\displaystyle -\mathbf {q} \cdot {\dot {\mathbf {p} }}-h(\mathbf {q} ,\mathbf {p} ,t)=\mathbf {p} \cdot {\dot {\mathbf {q} }}-k(\mathbf {q} ,\mathbf {p} ,t)+{\frac {\partial g_{3}}{\partial t}}+{\frac {\partial g_{3}}{\partial \mathbf {p} }}\cdot {\dot {\mathbf {p} }}+{\frac {\partial g_{3}}{\partial \mathbf {q} }}\cdot {\dot {\mathbf {q} }}}
  since the new and old coordinates are each independent, the following 2n + 1 equations must hold

  
    
      
        
          
            
              
                
                  q
                
              
              
                
                =
                −
                
                  
                    
                      ∂
                      
                        g
                        
                          3
                        
                      
                    
                    
                      ∂
                      
                        p
                      
                    
                  
                
              
            
            
              
                
                  p
                
              
              
                
                =
                −
                
                  
                    
                      ∂
                      
                        g
                        
                          3
                        
                      
                    
                    
                      ∂
                      
                        q
                      
                    
                  
                
              
            
            
              
                k
              
              
                
                =
                h
                +
                
                  
                    
                      ∂
                      
                        g
                        
                          3
                        
                      
                    
                    
                      ∂
                      t
                    
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\mathbf {q} &=-{\frac {\partial g_{3}}{\partial \mathbf {p} }}\\\mathbf {p} &=-{\frac {\partial g_{3}}{\partial \mathbf {q} }}\\k&=h+{\frac {\partial g_{3}}{\partial t}}\end{aligned}}}
  these equations define the transformation (q, p) → (q, p) as follows. the first set of n equations

  
    
      
        
          q
        
        =
        −
        
          
            
              ∂
              
                g
                
                  3
                
              
            
            
              ∂
              
                p
              
            
          
        
      
    
    {\displaystyle \mathbf {q} =-{\frac {\partial g_{3}}{\partial \mathbf {p} }}}
  define relations between the new generalized coordinates q and the old canonical coordinates (q, p).  ideally, one can invert these relations to obtain formulae for each qk as a function of the old canonical coordinates.  substitution of these formulae for the q coordinates into the second set of n equations

  
    
      
        
          p
        
        =
        −
        
          
            
              ∂
              
                g
                
                  3
                
              
            
            
              ∂
              
                q
              
            
          
        
      
    
    {\displaystyle \mathbf {p} =-{\frac {\partial g_{3}}{\partial \mathbf {q} }}}
  yields analogous formulae for the new generalized momenta p in terms of the old canonical coordinates (q, p).  we then invert both sets of formulae to obtain the old canonical coordinates (q, p) as functions of the new canonical coordinates (q, p). substitution of the inverted formulae into the final equation 

  
    
      
        k
        =
        h
        +
        
          
            
              ∂
              
                g
                
                  3
                
              
            
            
              ∂
              t
            
          
        
      
    
    {\displaystyle k=h+{\frac {\partial g_{3}}{\partial t}}}
  yields a formula for k as a function of the new canonical coordinates (q, p).
in practice, this procedure is easier than it sounds, because the generating function is usually simple.


=== type 4 generating function ===
the type 4 generating function 
  
    
      
        
          g
          
            4
          
        
        (
        
          p
        
        ,
        
          p
        
        ,
        t
        )
      
    
    {\displaystyle g_{4}(\mathbf {p} ,\mathbf {p} ,t)}
   depends only on the old and new generalized momenta

  
    
      
        g
        ≡
        
          q
        
        ⋅
        
          p
        
        −
        
          q
        
        ⋅
        
          p
        
        +
        
          g
          
            4
          
        
        (
        
          p
        
        ,
        
          p
        
        ,
        t
        )
      
    
    {\displaystyle g\equiv \mathbf {q} \cdot \mathbf {p} -\mathbf {q} \cdot \mathbf {p} +g_{4}(\mathbf {p} ,\mathbf {p} ,t)}
  where the 
  
    
      
        
          q
        
        ⋅
        
          p
        
        −
        
          q
        
        ⋅
        
          p
        
      
    
    {\displaystyle \mathbf {q} \cdot \mathbf {p} -\mathbf {q} \cdot \mathbf {p} }
   terms represent a legendre transformation to change both sides of the equation below.    to derive the implicit transformation, we expand the defining equation above

  
    
      
        −
        
          q
        
        ⋅
        
          
            
              
                p
              
              ˙
            
          
        
        −
        h
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
        =
        −
        
          q
        
        ⋅
        
          
            
              
                p
              
              ˙
            
          
        
        −
        k
        (
        
          q
        
        ,
        
          p
        
        ,
        t
        )
        +
        
          
            
              ∂
              
                g
                
                  4
                
              
            
            
              ∂
              t
            
          
        
        +
        
          
            
              ∂
              
                g
                
                  4
                
              
            
            
              ∂
              
                p
              
            
          
        
        ⋅
        
          
            
              
                p
              
              ˙
            
          
        
        +
        
          
            
              ∂
              
                g
                
                  4
                
              
            
            
              ∂
              
                p
              
            
          
        
        ⋅
        
          
            
              
                p
              
              ˙
            
          
        
      
    
    {\displaystyle -\mathbf {q} \cdot {\dot {\mathbf {p} }}-h(\mathbf {q} ,\mathbf {p} ,t)=-\mathbf {q} \cdot {\dot {\mathbf {p} }}-k(\mathbf {q} ,\mathbf {p} ,t)+{\frac {\partial g_{4}}{\partial t}}+{\frac {\partial g_{4}}{\partial \mathbf {p} }}\cdot {\dot {\mathbf {p} }}+{\frac {\partial g_{4}}{\partial \mathbf {p} }}\cdot {\dot {\mathbf {p} }}}
  since the new and old coordinates are each independent, the following 2n + 1 equations must hold

  
    
      
        
          
            
              
                
                  q
                
              
              
                
                =
                −
                
                  
                    
                      ∂
                      
                        g
                        
                          4
                        
                      
                    
                    
                      ∂
                      
                        p
                      
                    
                  
                
              
            
            
              
                
                  q
                
              
              
                
                =
                
                  
                    
                      ∂
                      
                        g
                        
                          4
                        
                      
                    
                    
                      ∂
                      
                        p
                      
                    
                  
                
              
            
            
              
                k
              
              
                
                =
                h
                +
                
                  
                    
                      ∂
                      
                        g
                        
                          4
                        
                      
                    
                    
                      ∂
                      t
                    
                  
                
              
            
          
        
      
    
    {\displaystyle {\begin{aligned}\mathbf {q} &=-{\frac {\partial g_{4}}{\partial \mathbf {p} }}\\\mathbf {q} &={\frac {\partial g_{4}}{\partial \mathbf {p} }}\\k&=h+{\frac {\partial g_{4}}{\partial t}}\end{aligned}}}
  these equations define the transformation (q, p) → (q, p) as follows. the first set of n equations

  
    
      
        
          q
        
        =
        −
        
          
            
              ∂
              
                g
                
                  4
                
              
            
            
              ∂
              
                p
              
            
          
        
      
    
    {\displaystyle \mathbf {q} =-{\frac {\partial g_{4}}{\partial \mathbf {p} }}}
  define relations between the new generalized momenta p and the old canonical coordinates (q, p).  ideally, one can invert these relations to obtain formulae for each pk as a function of the old canonical coordinates.  substitution of these formulae for the p coordinates into the second set of n equations

  
    
      
        
          q
        
        =
        
          
            
              ∂
              
                g
                
                  4
                
              
            
            
              ∂
              
                p
              
            
          
        
      
    
    {\displaystyle \mathbf {q} ={\frac {\partial g_{4}}{\partial \mathbf {p} }}}
  yields analogous formulae for the new generalized coordinates q in terms of the old canonical coordinates (q, p).  we then invert both sets of formulae to obtain the old canonical coordinates (q, p) as functions of the new canonical coordinates (q, p).  substitution of the inverted formulae into the final equation 

  
    
      
        k
        =
        h
        +
        
          
            
              ∂
              
                g
                
                  4
                
              
            
            
              ∂
              t
            
          
        
      
    
    {\displaystyle k=h+{\frac {\partial g_{4}}{\partial t}}}
  yields a formula for k as a function of the new canonical coordinates (q, p).


== motion as a canonical transformation ==
motion itself (or, equivalently, a shift in the time origin) is a canonical transformation. if 
  
    
      
        
          q
        
        (
        t
        )
        ≡
        
          q
        
        (
        t
        +
        τ
        )
      
    
    {\displaystyle \mathbf {q} (t)\equiv \mathbf {q} (t+\tau )}
   and 
  
    
      
        
          p
        
        (
        t
        )
        ≡
        
          p
        
        (
        t
        +
        τ
        )
      
    
    {\displaystyle \mathbf {p} (t)\equiv \mathbf {p} (t+\tau )}
  , then hamilton's principle is automatically satisfied

  
    
      
        δ
        
          ∫
          
            
              t
              
                1
              
            
          
          
            
              t
              
                2
              
            
          
        
        
          [
          
            
              p
            
            ⋅
            
              
                
                  
                    q
                  
                  ˙
                
              
            
            −
            k
            (
            
              q
            
            ,
            
              p
            
            ,
            t
            )
          
          ]
        
        d
        t
        =
        δ
        
          ∫
          
            
              t
              
                1
              
            
            +
            τ
          
          
            
              t
              
                2
              
            
            +
            τ
          
        
        
          [
          
            
              p
            
            ⋅
            
              
                
                  
                    q
                  
                  ˙
                
              
            
            −
            h
            (
            
              q
            
            ,
            
              p
            
            ,
            t
            +
            τ
            )
          
          ]
        
        d
        t
        =
        0
      
    
    {\displaystyle \delta \int _{t_{1}}^{t_{2}}\left[\mathbf {p} \cdot {\dot {\mathbf {q} }}-k(\mathbf {q} ,\mathbf {p} ,t)\right]dt=\delta \int _{t_{1}+\tau }^{t_{2}+\tau }\left[\mathbf {p} \cdot {\dot {\mathbf {q} }}-h(\mathbf {q} ,\mathbf {p} ,t+\tau )\right]dt=0}
  since a valid trajectory 
  
    
      
        (
        
          q
        
        (
        t
        )
        ,
        
          p
        
        (
        t
        )
        )
      
    
    {\displaystyle (\mathbf {q} (t),\mathbf {p} (t))}
   should always satisfy hamilton's principle, regardless of the endpoints.


== examples ==
the translation 
  
    
      
        
          q
        
        (
        
          q
        
        ,
        
          p
        
        )
        =
        
          q
        
        +
        
          a
        
        ,
        
          p
        
        (
        
          q
        
        ,
        
          p
        
        )
        =
        
          p
        
        +
        
          b
        
      
    
    {\displaystyle \mathbf {q} (\mathbf {q} ,\mathbf {p} )=\mathbf {q} +\mathbf {a} ,\mathbf {p} (\mathbf {q} ,\mathbf {p} )=\mathbf {p} +\mathbf {b} }
   where 
  
    
      
        
          a
        
        ,
        
          b
        
      
    
    {\displaystyle \mathbf {a} ,\mathbf {b} }
   are two constant vectors is a canonical transformation. indeed, the jacobian matrix is the identity, which is symplectic: 
  
    
      
        
          i
          
            t
          
        
        j
        i
        =
        j
      
    
    {\displaystyle i^{\text{t}}ji=j}
  .
set 
  
    
      
        
          x
        
        =
        (
        q
        ,
        p
        )
      
    
    {\displaystyle \mathbf {x} =(q,p)}
   and 
  
    
      
        
          x
        
        =
        (
        q
        ,
        p
        )
      
    
    {\displaystyle \mathbf {x} =(q,p)}
  , the transformation 
  
    
      
        
          x
        
        (
        
          x
        
        )
        =
        r
        
          x
        
      
    
    {\displaystyle \mathbf {x} (\mathbf {x} )=r\mathbf {x} }
   where 
  
    
      
        r
        ∈
        s
        o
        (
        2
        )
      
    
    {\displaystyle r\in so(2)}
   is a rotation matrix of order 2 is canonical. keeping in mind that special orthogonal matrices obey 
  
    
      
        
          r
          
            t
          
        
        r
        =
        i
      
    
    {\displaystyle r^{\text{t}}r=i}
   it's easy to see that the jacobian is symplectic. be aware that this example only works in dimension 2: 
  
    
      
        s
        o
        (
        2
        )
      
    
    {\displaystyle so(2)}
   is the only special orthogonal group in which every matrix is symplectic.
the transformation 
  
    
      
        (
        q
        (
        q
        ,
        p
        )
        ,
        p
        (
        q
        ,
        p
        )
        )
        =
        (
        q
        +
        f
        (
        p
        )
        ,
        p
        )
      
    
    {\displaystyle (q(q,p),p(q,p))=(q+f(p),p)}
  , where 
  
    
      
        f
        (
        p
        )
      
    
    {\displaystyle f(p)}
   is an arbitrary function of 
  
    
      
        p
      
    
    {\displaystyle p}
  , is canonical. jacobian matrix is indeed given by :
  
    
      
        
          
            
              ∂
              x
            
            
              ∂
              x
            
          
        
        =
        
          
            [
            
              
                
                  1
                
                
                  
                    f
                    ′
                  
                  (
                  p
                  )
                
              
              
                
                  0
                
                
                  1
                
              
            
            ]
          
        
      
    
    {\displaystyle {\frac {\partial x}{\partial x}}={\begin{bmatrix}1&f'(p)\\0&1\end{bmatrix}}}
   which is symplectic.


== modern mathematical description ==
in mathematical terms, canonical coordinates are any coordinates on the phase space (cotangent bundle) of the system that allow the canonical one-form to be written  as

  
    
      
        
          ∑
          
            i
          
        
        
          p
          
            i
          
        
        
        d
        
          q
          
            i
          
        
      
    
    {\displaystyle \sum _{i}p_{i}\,dq^{i}}
  up to a total differential (exact form). the change of variable between one set of canonical coordinates and another is a canonical transformation.   the index of the generalized coordinates q is written here as a superscript (
  
    
      
        
          q
          
            i
          
        
      
    
    {\displaystyle q^{i}}
  ), not as a subscript as done above (
  
    
      
        
          q
          
            i
          
        
      
    
    {\displaystyle q_{i}}
  ).  the superscript conveys the contravariant transformation properties of the generalized coordinates, and does not mean that the coordinate is being raised to a power.  further details may be found at the symplectomorphism article.


== history ==
the first major application of the canonical transformation was in 1846, by charles delaunay, in the study of the earth-moon-sun system. this work resulted in the publication of a pair of large volumes as mémoires by the french academy of sciences, in 1860 and 1867.


== see also ==
symplectomorphism
hamilton–jacobi equation
liouville's theorem (hamiltonian)
mathieu transformation
linear canonical transformation


== references ==

goldstein, herbert (1980). classical mechanics (2d ed.). reading, mass.: addison-wesley pub. co. p. 380. isbn 0-201-02918-9.
landau, l. d.; lifshitz, e. m. (1975) [1939]. mechanics. translated by bell, s. j.; sykes, j. b. (3rd ed.). amsterdam: elsevier. isbn 978-0-7506-28969.